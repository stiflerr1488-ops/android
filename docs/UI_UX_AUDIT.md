# TeamCompass — UX/UI аудит и план улучшений (Material 3, Compose)

## 1) Короткое резюме (5–7 строк)
Сейчас приложение уже имеет понятный каркас пользовательского пути: Splash → Join → Compass → Settings, а основной экран (радар) занимает весь фокус сценария.
Главные точки роста — снижение когнитивной нагрузки на входе, явность ключевых CTA на радаре и системная стандартизация состояний (loading/empty/error).
Визуальная база в целом сильная (единая палитра, spacing-токены, M3-компоненты), но часть токенов/паттернов применяется непоследовательно (локальные `dp`, смешанная семантика иконок, разный стиль текстов ошибок).
Из-за большого числа жестов и режимов на Compass новичку тяжело быстро понять «что делать дальше» без встроенного обучения.
После предложенных правок ожидается: меньше времени до первого полезного действия, выше completion входа в команду, меньше ошибок интерпретации статусов и лучше доступность.
Фокус MVP: 1) Join-поток в 2 явных шага, 2) onboarding и легенда на Compass, 3) унификация state/feedback, 4) accessibility baseline.

## 2) Top Issues (таблица)

| Priority | Problem | Impact | Fix | Where in code |
|---|---|---|---|---|
| High | Splash всегда держит фиксированную задержку 650ms даже при готовой авторизации. | Увеличивает Time-to-Interactive и создаёт «лишнее ожидание» при каждом запуске. | Сделать адаптивную задержку (например 250–500ms max) и переход сразу после `isAuthReady`. | `TacticalSplash()` в `TeamCompassApp.kt` |
| High | Join объединяет 2 намерения (создать/войти) в одном блоке без явного разведения сценариев. | Новые пользователи дольше принимают решение, растёт риск отказа на первом экране. | Разделить на 2 отдельные карточки действий с короткими подзаголовками и одним primary CTA в каждом блоке. | `JoinScreen()` в `TeamCompassApp.kt` |
| High | На Compass много действий (жесты, кнопки, меню), но нет встроенного первого обучения. | Низкая discoverability: пользователь не понимает «как поставить точку/противника» без догадки. | Добавить one-time bottom sheet «Как пользоваться» + кнопку справки `?`. | `CompassScreen()` в `TeamCompassApp.kt` |
| High | Ошибки приходят через snackbar без разделения по типу и без системного recovery-паттерна. | Пользователь получает ошибку, но не всегда понимает следующий шаг. | Ввести Error model: причина + recommended action (Повторить/Открыть настройки/Скопировать диагностику). | `vm.events.collect { UiEvent.Error }` в `TeamCompassApp.kt`, `emitError()` в `TeamCompassViewModel.kt` |
| High | Постоянно тёмная тема `darkTheme = true`. | Нет адаптации под системные настройки и освещённость, ухудшение читаемости на части устройств. | Переключиться на `isSystemInDarkTheme()` + опция override в настройках. | `MainActivity.kt`, `Theme.kt` |
| High | Часть важных иконок не имеет `contentDescription` (или `null`). | Снижается доступность для TalkBack и навигации по ассистивным технологиям. | Для action-иконок добавить осмысленные описания; оставлять `null` только для декоративных. | `SettingsScreen.kt`, `TeamCompassApp.kt` |
| Medium | В коде одновременно используются токены `Spacing` и локальные `dp` (например 24/16/10/88). | Непоследовательный ритм интерфейса и сложнее поддержка дизайн-системы. | Вынести scale spacing (4/8/12/16/24/32/48/64) и заменить «магические» `dp`. | `TeamCompassApp.kt`, `SettingsScreen.kt`, `theme/Spacing.kt` |
| Medium | Join валидация жёстко привязана к длине кода `6`, но подсказки формата ограничены. | Пользователь не понимает, почему не проходит ввод (особенно при вставке/пробелах). | Добавить input normalization + helper/error text до сабмита + автоформатирование кода. | `JoinScreen()` в `TeamCompassApp.kt` |
| Medium | На радарах/оверлеях много объектов, но легенда смыслов и цветов не встроена в UI. | Ошибки интерпретации маркеров «свой/чужой/точка», особенно у новых пользователей. | Добавить легенду в bottom sheet и краткие подписи в empty state. | `CompassScreen()` + `RadarOverlay.kt` |
| Medium | Диагностика в Settings отображается как длинный текстовый блок без группировки. | Трудно быстро понять статус и приоритет проблемы. | Сделать карточки статуса с severity (OK/Warning/Error), icon + CTA. | `SettingsScreen.kt` |
| Medium | Слайдеры настроек не показывают trade-off «батарея/точность» на уровне выбора. | Пользователь может выбрать экстремальные значения, не понимая последствий. | Добавить подписи влияния, «рекомендуемые пресеты», и предупреждение при агрессивных значениях. | `PolicyCard()` в `SettingsScreen.kt` |
| Medium | Команды и статусы в интерфейсе частично технические (diag/error reason без user-friendly формулировки). | Снижает NPS и доверие к системе при проблемах с сетью/бэкендом. | Упрощённый слой microcopy: «что случилось / что сделать». | `TeamCompassViewModel.kt`, `SettingsScreen.kt` |
| Low | Нет выделенного empty-state для команды/целей (когда данных ещё нет). | Экран воспринимается как «пустой/непонятный», падает уверенность в системе. | Добавить пустые состояния с кратким обучающим CTA. | `CompassScreen()` |
| Low | Отсутствует единый каталог компонентов/превью сценариев состояний. | Регрессии UI заметны позже, медленнее итерации команды. | Ввести Compose Preview matrix + компоненты-контракт в `ui/components`. | `ui/*`, `ui/theme/*` |
| Low | Не видно системы визуального приоритета для вторичных действий на верхнем уровне. | Визуальный шум на плотных экранах и снижение скорости выполнения главного действия. | Ограничить до 1 primary CTA на контекст + secondary в overflow/bottom sheet. | `CompassScreen()` |

## 3) Рекомендации по визуалу

### Цвета/контраст
- Сохранить текущую «olive/sand» айдентику, но формализовать semantic-токены: `success`, `warning`, `error`, `info`, `outlineStrong`.
- Проверить контраст текстов поверх `surfaceVariant` и overlay-элементов радара (цель — не ниже WCAG AA).
- Для error/warning на тёмной теме использовать не только цвет, но и иконку + явный заголовок.

### Типографика
- Базовая `Typography` уже подключена — следующий шаг: описать usage-гайд (какой стиль для title/card/meta/helper/error).
- Запретить локальные ручные веса/размеры там, где хватает токенов `MaterialTheme.typography.*`.
- Для dense-инфо блоков (диагностика) использовать табличный/моноширинный стиль только там, где это помогает сканированию.

### Сетка/отступы
- Свести все отступы к scale токенам и убрать «магические» 10/14/26/88dp в ключевых composable.
- Установить вертикальный ритм по сетке 8dp, а для интерактивных зон — минимум 48dp высоты touch target.
- Для карточек с управлением (Join/Settings) фиксировать единый паттерн: title → helper → control → status.

### Компоненты (кнопки/инпуты/карточки/диалоги)
- **Buttons:** на каждом экране оставить 1 доминирующий primary action; остальные — tonal/outlined.
- **Inputs (Join):** helper text + inline validation + автонормализация (caps/trim).
- **Cards:** унифицировать радиусы и elevation (например, default 16dp radius, contextual variants).
- **Dialogs/Sheets:** использовать для обучения жестам, легенды и подтверждения destructive actions.

### Состояния (loading/empty/error)
- Ввести единый state-contract для экранов: `Loading`, `Content`, `Empty`, `Error`.
- Для `Error` всегда показывать: причина (human text) + действие (Retry / Settings / Support payload).
- Для `Empty` (нет маркеров, нет команды, нет карты) — краткая объясняющая подсказка и CTA.

### Accessibility
- Touch targets всех action элементов ≥ 48dp.
- Обязательные `contentDescription` для всех важных иконок; `null` только для декоративных.
- Проверка с TalkBack: правильный порядок фокуса, понятные названия экранов и действий.
- Проверка масштабирования шрифта до 200% без наложений на Join/Settings/Compass overlays.

## 4) UX/Логика: текущие флоу → проблемы → предложенный флоу

### Сценарий: новый пользователь
- **Сейчас:** Splash (фикс. задержка) → Join (ввод позывного + создать/войти в одном кластере) → Compass с множеством жестов.
- **Проблемы:** задержка старта, перегрузка решения на Join, неочевидные действия на Compass.
- **После:**
  - Splash: быстрый адаптивный выход.
  - Join: шаг 1 (позывной) → шаг 2 (выбор: создать / войти по коду).
  - Compass: one-time onboarding + первичный CTA «Отметить/Действовать».

### Сценарий: возвратный пользователь
- **Сейчас:** вход быстрый, но статусы/ошибки не всегда объясняют дальнейшие шаги.
- **Проблемы:** recovery при ошибках сети/RTDB не систематизирован.
- **После:**
  - Единые сообщения ошибок с конкретным action.
  - В Settings — читабельная диагностика + рекомендованные действия.

### Ключевая цель: быстрое командное действие на радаре
- **Сейчас:** действие доступно, но пользователю нужно «знать интерфейс» заранее.
- **Проблемы:** большой объём скрытых жестов снижает скорость выполнения цели.
- **После:**
  - Явный главный CTA для текущего контекста.
  - Легенда маркеров/цветов и короткие подсказки по жестам.
  - Быстрый feedback после действия (успешно отправлено / ошибка с retry).

### MVP-улучшения (минимальный набор)
- Join в 2 шага с inline validation.
- Compass onboarding + legend sheet.
- Унифицированные error/empty/loading состояния.
- Accessibility baseline (48dp + contentDescription + focus order).

### Nice-to-have (расширенный набор)
- Пресеты профилей трекинга («Эконом», «Баланс», «Точность»).
- Компонентный каталог + screenshot tests.
- A/B тестирование вариаций Join и CTA на Compass.

## 5) План внедрения

| Task | Effort | Impact | Risk | Modules | Acceptance criteria |
|---|---|---|---|---|---|
| Убрать фиксированную задержку Splash (адаптивный выход) | S (1 день) | High | Low | `ui/TeamCompassApp.kt` | Переход на следующий экран происходит сразу при `isAuthReady`, средний TTI снижен. |
| Разделить Join на 2 шага + улучшить inline validation | M (2 дня) | High | Medium | `ui/TeamCompassApp.kt`, `ui/TeamCompassViewModel.kt` | Completion входа растёт, ошибки ввода сокращены, пользователь понимает формат кода. |
| Добавить Compass onboarding + legend sheet | M (2–3 дня) | High | Medium | `ui/TeamCompassApp.kt`, `ui/RadarOverlay.kt` | Новые пользователи проходят ключевое действие без внешних инструкций. |
| Стандартизировать Error/Empty/Loading паттерн | M (3 дня) | High | Medium | `ui/*`, `viewmodel` | Для каждого экрана есть предсказуемое поведение и CTA в ошибках/пустых состояниях. |
| Accessibility pass (touch targets, semantics, TalkBack) | M (2–3 дня) | High | Low | `ui/*` | Все ключевые контроли ≥48dp, TalkBack корректно озвучивает действия и статусы. |
| Унифицировать spacing/shape токены и убрать магические dp | M (3–4 дня) | Medium | Low | `ui/theme/*`, `ui/*` | Линтер/ревью не допускает случайных размеров; UI ритм консистентен. |
| Улучшить Settings: статусные карточки + понятные рекомендации | S-M (1–2 дня) | Medium | Low | `ui/SettingsScreen.kt` | Диагностика читается за 5–10 секунд, есть действия для восстановления. |
| Добавить UI Preview matrix + screenshot tests критичных экранов | L (1–2 недели) | Medium | Medium | `ui/components`, `app/src/test` | Ключевые состояния экранов покрыты snapshot/preview, регрессии ловятся до QA. |
| Внедрить system dark/light + ручной override в Settings | M (2–3 дня) | Medium | Medium | `MainActivity.kt`, `ui/theme/*`, `Settings` | Тема соответствует системной, пользователь может принудительно выбрать режим. |
| Ввести метрики флоу (Join funnel, CTA conversion, error recovery) | M (3–5 дней) | High | Medium | analytics/events слой | Видны baseline и пост-эффект изменений по conversion/drop-off. |

## 6) Примеры/шаблоны (токены, компоненты, структура темы)

### Пример дизайн-токенов (Compose)
```kotlin
object UiTokens {
    object Space {
        val s4 = 4.dp; val s8 = 8.dp; val s12 = 12.dp; val s16 = 16.dp
        val s24 = 24.dp; val s32 = 32.dp; val s48 = 48.dp
    }
    object Radius {
        val sm = 12.dp; val md = 16.dp; val lg = 24.dp
    }
}
```

### Контракт экранного состояния
```kotlin
sealed interface ScreenState<out T> {
    data object Loading : ScreenState<Nothing>
    data class Content<T>(val data: T) : ScreenState<T>
    data class Empty(val title: String, val cta: String?) : ScreenState<Nothing>
    data class Error(val title: String, val message: String, val action: UiAction?) : ScreenState<Nothing>
}
```

### Целевые метрики успеха
- Снижение шагов до ключевого действия на основном флоу: **-20–30%**.
- Рост конверсии в ключевое действие (Join → Compass active use): **+8–15%**.
- Снижение отказов на Join: **-15–25%**.
- Субъективное качество UI по внутреннему чек-листу: **до 8.5/10**.
- Accessibility score (контраст/тач-таргеты/семантика): **до 90%+ прохождения чек-листа**.
