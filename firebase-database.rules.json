{
  "rules": {
    ".read": false,
    ".write": false,
    "users": {
      ".read": "auth != null",
      ".indexOn": [
        "updatedAtMs",
        "callsignLower"
      ],
      "$uid": {
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "userGear": {
      "$uid": {
        ".read": "auth != null",
        ".indexOn": [
          "createdAt"
        ],
        "$gearId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "userGameHistory": {
      "$uid": {
        ".read": "auth != null",
        ".indexOn": [
          "date"
        ],
        "$historyId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "userAchievements": {
      "$uid": {
        ".read": "auth != null",
        ".indexOn": [
          "updatedAtMs"
        ],
        "$achievementId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "userTrustBadges": {
      "$uid": {
        ".read": "auth != null",
        ".indexOn": [
          "updatedAtMs"
        ],
        "$badgeId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "events": {
      ".read": "auth != null",
      ".indexOn": [
        "eventDate",
        "updatedAtMs"
      ],
      "$eventId": {
        ".write": "auth != null && (!data.exists() || data.child('ownerId').val() == auth.uid)"
      }
    },
    "eventParticipants": {
      "$eventId": {
        "$uid": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "marketListings": {
      ".read": "auth != null",
      ".indexOn": [
        "updatedAtMs",
        "sellerId",
        "titleLower"
      ],
      "$listingId": {
        ".write": "auth != null && (!data.exists() || data.child('sellerId').val() == auth.uid)"
      }
    },
    "userListings": {
      "$uid": {
        ".read": "auth != null",
        ".indexOn": [
          "updatedAtMs"
        ],
        "$listingId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "chatThreads": {
      ".read": "auth != null",
      ".indexOn": [
        "updatedAtMs"
      ],
      "$threadId": {
        ".write": "auth != null && (!data.exists() || data.child('ownerId').val() == auth.uid)"
      }
    },
    "chatMessages": {
      "$threadId": {
        ".read": "auth != null",
        ".indexOn": [
          "createdAtMs"
        ],
        "$messageId": {
          ".write": "auth != null && (!data.exists() || data.child('senderId').val() == auth.uid)"
        }
      }
    },
    "userThreads": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".indexOn": [
          "updatedAtMs"
        ],
        "$threadId": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },
    "teams": {
      "$teamCode": {
        ".write": "auth != null && !data.exists() && newData.hasChildren(['meta', 'members']) && newData.child('meta').child('createdBy').val() == auth.uid && newData.child('members').child(auth.uid).exists()",
        "meta": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".write": "auth != null && root.child('teams').child($teamCode).child('meta').child('createdBy').val() == auth.uid",
          ".validate": "!newData.exists() || (newData.hasChildren(['createdAtMs', 'createdBy', 'isLocked', 'expiresAtMs', 'joinSalt', 'joinHash']) && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val().length > 0 && newData.child('isLocked').isBoolean() && newData.child('expiresAtMs').isNumber() && newData.child('expiresAtMs').val() > newData.child('createdAtMs').val() && newData.child('joinSalt').isString() && newData.child('joinSalt').val().matches(/^[0-9a-fA-F]{16,128}$/) && newData.child('joinHash').isString() && newData.child('joinHash').val().matches(/^[0-9a-fA-F]{64}$/) && (!data.exists() || (newData.child('createdAtMs').val() == data.child('createdAtMs').val() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('joinSalt').val() == data.child('joinSalt').val() && newData.child('joinHash').val() == data.child('joinHash').val())))"
        },
        "members": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "$uid": {
            ".write": "auth != null && auth.uid == $uid && (data.exists() || (root.child('teams').child($teamCode).child('meta').child('isLocked').val() == false && (!root.child('teams').child($teamCode).child('meta').child('expiresAtMs').exists() || now <= root.child('teams').child($teamCode).child('meta').child('expiresAtMs').val())))",
            ".validate": "!newData.exists() || (newData.hasChildren(['callsign', 'joinedAtMs']) && newData.child('callsign').isString() && newData.child('callsign').val().length > 0 && newData.child('callsign').val().length <= 24 && newData.child('joinedAtMs').isNumber() && (!data.exists() || newData.child('joinedAtMs').val() == data.child('joinedAtMs').val()))"
          }
        },
        "memberRoles": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "commandRole",
            "sideId",
            "companyId",
            "platoonId",
            "teamId"
          ],
          "$uid": {
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && newData.exists() && ((auth.uid == $uid && ((!data.exists() && newData.child('commandRole').val() == 'FIGHTER' && !newData.child('companyId').exists() && !newData.child('platoonId').exists() && !newData.child('teamId').exists() && !newData.child('vehicleId').exists()) || (data.exists() && newData.child('commandRole').val() == data.child('commandRole').val() && newData.child('sideId').val() == data.child('sideId').val() && newData.child('companyId').val() == data.child('companyId').val() && newData.child('platoonId').val() == data.child('platoonId').val() && newData.child('teamId').val() == data.child('teamId').val() && newData.child('vehicleRole').val() == data.child('vehicleRole').val() && newData.child('vehicleId').val() == data.child('vehicleId').val()))) || (auth.uid != $uid && ((root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('commandRole').val() == 'SIDE_COMMANDER' && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('sideId').val() == newData.child('sideId').val()) || (root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('commandRole').val() == 'COMPANY_COMMANDER' && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('sideId').val() == newData.child('sideId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('companyId').val() == newData.child('companyId').val() && (newData.child('commandRole').val() == 'COMPANY_COMMANDER' || newData.child('commandRole').val() == 'PLATOON_COMMANDER' || newData.child('commandRole').val() == 'TEAM_COMMANDER' || newData.child('commandRole').val() == 'TEAM_DEPUTY' || newData.child('commandRole').val() == 'FIGHTER')) || (root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('commandRole').val() == 'PLATOON_COMMANDER' && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('sideId').val() == newData.child('sideId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('companyId').val() == newData.child('companyId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('platoonId').val() == newData.child('platoonId').val() && (newData.child('commandRole').val() == 'PLATOON_COMMANDER' || newData.child('commandRole').val() == 'TEAM_COMMANDER' || newData.child('commandRole').val() == 'TEAM_DEPUTY' || newData.child('commandRole').val() == 'FIGHTER')) || (root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('commandRole').val() == 'TEAM_COMMANDER' && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('sideId').val() == newData.child('sideId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('companyId').val() == newData.child('companyId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('platoonId').val() == newData.child('platoonId').val() && root.child('teams').child($teamCode).child('memberRoles').child(auth.uid).child('teamId').val() == newData.child('teamId').val() && (newData.child('commandRole').val() == 'TEAM_COMMANDER' || newData.child('commandRole').val() == 'TEAM_DEPUTY' || newData.child('commandRole').val() == 'FIGHTER')))))",
            ".validate": "!newData.exists() || (newData.hasChildren(['commandRole', 'combatRole', 'vehicleRole', 'sideId', 'updatedAtMs']) && newData.child('commandRole').isString() && (newData.child('commandRole').val() == 'SIDE_COMMANDER' || newData.child('commandRole').val() == 'COMPANY_COMMANDER' || newData.child('commandRole').val() == 'PLATOON_COMMANDER' || newData.child('commandRole').val() == 'TEAM_COMMANDER' || newData.child('commandRole').val() == 'TEAM_DEPUTY' || newData.child('commandRole').val() == 'FIGHTER') && newData.child('combatRole').isString() && (newData.child('combatRole').val() == 'NONE' || newData.child('combatRole').val() == 'ASSAULTER' || newData.child('combatRole').val() == 'SCOUT' || newData.child('combatRole').val() == 'SNIPER' || newData.child('combatRole').val() == 'MORTAR') && newData.child('vehicleRole').isString() && (newData.child('vehicleRole').val() == 'NONE' || newData.child('vehicleRole').val() == 'DRIVER' || newData.child('vehicleRole').val() == 'ASSISTANT_DRIVER' || newData.child('vehicleRole').val() == 'PASSENGER') && newData.child('sideId').isString() && newData.child('sideId').val().length > 0 && newData.child('sideId').val().length <= 32 && (!newData.child('companyId').exists() || (newData.child('companyId').isString() && newData.child('companyId').val().length > 0 && newData.child('companyId').val().length <= 32)) && (!newData.child('platoonId').exists() || (newData.child('platoonId').isString() && newData.child('platoonId').val().length > 0 && newData.child('platoonId').val().length <= 32)) && (!newData.child('teamId').exists() || (newData.child('teamId').isString() && newData.child('teamId').val().length > 0 && newData.child('teamId').val().length <= 32)) && (!newData.child('vehicleId').exists() || (newData.child('vehicleId').isString() && newData.child('vehicleId').val().length > 0 && newData.child('vehicleId').val().length <= 32)) && (!newData.child('callsign').exists() || (newData.child('callsign').isString() && newData.child('callsign').val().length <= 24)) && (!newData.child('updatedBy').exists() || (newData.child('updatedBy').isString() && newData.child('updatedBy').val() == auth.uid)) && newData.child('updatedAtMs').isNumber() && (!data.exists() || newData.child('updatedAtMs').val() >= data.child('updatedAtMs').val()) && ((newData.child('commandRole').val() == 'SIDE_COMMANDER') || (newData.child('commandRole').val() == 'COMPANY_COMMANDER' && newData.child('companyId').exists()) || (newData.child('commandRole').val() == 'PLATOON_COMMANDER' && newData.child('companyId').exists() && newData.child('platoonId').exists()) || (newData.child('commandRole').val() == 'TEAM_COMMANDER' && newData.child('companyId').exists() && newData.child('platoonId').exists() && newData.child('teamId').exists()) || (newData.child('commandRole').val() == 'TEAM_DEPUTY' && newData.child('companyId').exists() && newData.child('platoonId').exists() && newData.child('teamId').exists()) || (newData.child('commandRole').val() == 'FIGHTER' && ((newData.child('companyId').exists() && newData.child('platoonId').exists() && newData.child('teamId').exists()) || (!newData.child('companyId').exists() && !newData.child('platoonId').exists() && !newData.child('teamId').exists())))))"
          }
        },
        "state": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "ts"
          ],
          "$uid": {
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['callsign', 'lat', 'lon', 'acc', 'speed', 'ts', 'mode', 'anchored', 'sosUntilMs']) && newData.child('callsign').isString() && newData.child('callsign').val().length > 0 && newData.child('callsign').val().length <= 24 && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('acc').isNumber() && newData.child('speed').isNumber() && (!newData.child('heading').exists() || newData.child('heading').isNumber()) && newData.child('ts').isNumber() && newData.child('ts').val() <= now + 60000 && (newData.child('mode').val() == 'GAME' || newData.child('mode').val() == 'DEAD') && newData.child('anchored').isBoolean() && newData.child('sosUntilMs').isNumber() && (!newData.child('cellId').exists() || (newData.child('cellId').isString() && newData.child('cellId').val().matches(/^[0-9a-z]{1,12}$/))))"
          }
        },
        "stateCells": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "$cellId": {
            ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            "$uid": {
              ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && (!newData.exists() || newData.child('cellId').val() == $cellId)",
              ".validate": "!newData.exists() || (newData.hasChildren(['callsign', 'lat', 'lon', 'acc', 'speed', 'ts', 'mode', 'anchored', 'sosUntilMs', 'cellId']) && newData.child('callsign').isString() && newData.child('callsign').val().length > 0 && newData.child('callsign').val().length <= 24 && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('acc').isNumber() && newData.child('speed').isNumber() && (!newData.child('heading').exists() || newData.child('heading').isNumber()) && newData.child('ts').isNumber() && newData.child('ts').val() <= now + 60000 && (newData.child('mode').val() == 'GAME' || newData.child('mode').val() == 'DEAD') && newData.child('anchored').isBoolean() && newData.child('sosUntilMs').isNumber() && newData.child('cellId').isString() && newData.child('cellId').val() == $cellId && newData.child('cellId').val().matches(/^[0-9a-z]{1,12}$/))"
            }
          }
        },
        "points": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "createdAtMs",
            "createdBy"
          ],
          "$pointId": {
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && data.child('createdBy').val() == auth.uid))",
            ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'label', 'icon', 'createdAtMs', 'createdBy']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('label').isString() && newData.child('label').val().length <= 80 && newData.child('icon').isString() && newData.child('icon').val().length > 0 && newData.child('icon').val().length <= 32 && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val().length > 0 && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'TEAM') && (!newData.child('kind').exists() || newData.child('kind').val() == 'POINT') && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
          }
        },
        "privatePoints": {
          "$uid": {
            ".read": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".indexOn": [
              "createdAtMs"
            ],
            "$pointId": {
              ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'label', 'icon', 'createdAtMs', 'createdBy']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('label').isString() && newData.child('label').val().length <= 80 && newData.child('icon').isString() && newData.child('icon').val().length > 0 && newData.child('icon').val().length <= 32 && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'PRIVATE') && (!newData.child('kind').exists() || newData.child('kind').val() == 'POINT') && (!data.exists() || (newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
            }
          }
        },
        "enemyPings": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "createdAtMs",
            "expiresAtMs"
          ],
          "$pingId": {
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && ((!data.exists() && newData.child('createdBy').val() == auth.uid && (!root.child('teams').child($teamCode).child('rateLimits').child('enemyPing').child(auth.uid).child('lastAtMs').exists() || newData.child('createdAtMs').val() >= root.child('teams').child($teamCode).child('rateLimits').child('enemyPing').child(auth.uid).child('lastAtMs').val() + 1200) && newData.root.child('teams').child($teamCode).child('rateLimits').child('enemyPing').child(auth.uid).child('lastAtMs').val() == newData.child('createdAtMs').val()) || (data.exists() && data.child('createdBy').val() == auth.uid))",
            ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'createdAtMs', 'createdBy', 'expiresAtMs']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('createdAtMs').isNumber() && newData.child('createdAtMs').val() <= now + 5000 && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid && newData.child('expiresAtMs').isNumber() && newData.child('expiresAtMs').val() > newData.child('createdAtMs').val() && newData.child('expiresAtMs').val() <= newData.child('createdAtMs').val() + 600000 && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'TEAM_EVENT') && (!newData.child('kind').exists() || newData.child('kind').val() == 'ENEMY_PING') && (!newData.child('type').exists() || (newData.child('type').val() == 'ENEMY' || newData.child('type').val() == 'ATTACK' || newData.child('type').val() == 'DEFENSE' || newData.child('type').val() == 'DANGER' || newData.child('type').val() == 'BLUETOOTH')) && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
          }
        },
        "rateLimits": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "enemyPing": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
              ".validate": "!newData.exists() || (newData.hasChildren(['lastAtMs']) && newData.child('lastAtMs').isNumber() && newData.child('lastAtMs').val() <= now + 5000 && (!data.child('lastAtMs').exists() || newData.child('lastAtMs').val() >= data.child('lastAtMs').val()))"
            }
          }
        },
        "commands": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "active": {
            ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['id', 'type', 'createdAtMs', 'createdBy']) && newData.child('id').isString() && newData.child('id').val().length > 0 && newData.child('id').val().length <= 64 && newData.child('type').isString() && (newData.child('type').val() == 'ENEMY' || newData.child('type').val() == 'ATTACK' || newData.child('type').val() == 'DEFENSE' || newData.child('type').val() == 'DANGER' || newData.child('type').val() == 'RALLY' || newData.child('type').val() == 'RETREAT') && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid)"
          }
        },
        "memberPrefs": {
          "$uid": {
            ".read": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['preset', 'nearRadiusM', 'showDead', 'showStale', 'focusMode', 'updatedAtMs']) && newData.child('preset').isString() && (newData.child('preset').val() == 'ALL' || newData.child('preset').val() == 'SOS' || newData.child('preset').val() == 'NEAR' || newData.child('preset').val() == 'ACTIVE') && newData.child('nearRadiusM').isNumber() && newData.child('nearRadiusM').val() >= 50 && newData.child('nearRadiusM').val() <= 500 && newData.child('showDead').isBoolean() && newData.child('showStale').isBoolean() && newData.child('focusMode').isBoolean() && newData.child('updatedAtMs').isNumber() && (!data.exists() || newData.child('updatedAtMs').val() >= data.child('updatedAtMs').val()))"
          }
        }
      }
    }
  }
}


