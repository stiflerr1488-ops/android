{
  "rules": {
    ".read": false,
    ".write": false,
    "teams": {
      "$teamCode": {
        ".write": "auth != null && !data.exists() && newData.hasChildren(['meta', 'members']) && newData.child('meta').child('createdBy').val() == auth.uid && newData.child('members').child(auth.uid).exists()",
        "meta": {
          ".read": "auth != null",
          ".write": "auth != null && root.child('teams').child($teamCode).child('meta').child('createdBy').val() == auth.uid",
          ".validate": "!newData.exists() || (newData.hasChildren(['createdAtMs', 'createdBy', 'isLocked', 'expiresAtMs', 'joinSalt', 'joinHash']) && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val().length > 0 && newData.child('isLocked').isBoolean() && newData.child('expiresAtMs').isNumber() && newData.child('expiresAtMs').val() > newData.child('createdAtMs').val() && newData.child('joinSalt').isString() && newData.child('joinSalt').val().matches(/^[0-9a-fA-F]{16,128}$/) && newData.child('joinHash').isString() && newData.child('joinHash').val().matches(/^[0-9a-fA-F]{64}$/) && (!data.exists() || (newData.child('createdAtMs').val() == data.child('createdAtMs').val() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('joinSalt').val() == data.child('joinSalt').val() && newData.child('joinHash').val() == data.child('joinHash').val())))"
        },
        "members": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "$uid": {
            ".write": "auth != null && auth.uid == $uid && (data.exists() || (root.child('teams').child($teamCode).child('meta').child('isLocked').val() == false && (!root.child('teams').child($teamCode).child('meta').child('expiresAtMs').exists() || now <= root.child('teams').child($teamCode).child('meta').child('expiresAtMs').val())))",
            ".validate": "!newData.exists() || (newData.hasChildren(['callsign', 'joinedAtMs']) && newData.child('callsign').isString() && newData.child('callsign').val().length > 0 && newData.child('callsign').val().length <= 24 && newData.child('joinedAtMs').isNumber() && (!data.exists() || newData.child('joinedAtMs').val() == data.child('joinedAtMs').val()))"
          }
        },
        "state": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "ts"
          ],
          "$uid": {
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['callsign', 'lat', 'lon', 'acc', 'speed', 'ts', 'mode', 'anchored', 'sosUntilMs']) && newData.child('callsign').isString() && newData.child('callsign').val().length > 0 && newData.child('callsign').val().length <= 24 && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('acc').isNumber() && newData.child('speed').isNumber() && (!newData.child('heading').exists() || newData.child('heading').isNumber()) && newData.child('ts').isNumber() && newData.child('ts').val() <= now + 60000 && (newData.child('mode').val() == 'GAME' || newData.child('mode').val() == 'DEAD') && newData.child('anchored').isBoolean() && newData.child('sosUntilMs').isNumber())"
          }
        },
        "points": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "createdAtMs",
            "createdBy"
          ],
          "$pointId": {
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && data.child('createdBy').val() == auth.uid))",
            ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'label', 'icon', 'createdAtMs', 'createdBy']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('label').isString() && newData.child('label').val().length <= 80 && newData.child('icon').isString() && newData.child('icon').val().length > 0 && newData.child('icon').val().length <= 32 && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val().length > 0 && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'TEAM') && (!newData.child('kind').exists() || newData.child('kind').val() == 'POINT') && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
          }
        },
        "privatePoints": {
          "$uid": {
            ".read": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".indexOn": [
              "createdAtMs"
            ],
            "$pointId": {
              ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'label', 'icon', 'createdAtMs', 'createdBy']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('label').isString() && newData.child('label').val().length <= 80 && newData.child('icon').isString() && newData.child('icon').val().length > 0 && newData.child('icon').val().length <= 32 && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'PRIVATE') && (!newData.child('kind').exists() || newData.child('kind').val() == 'POINT') && (!data.exists() || (newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
            }
          }
        },
        "enemyPings": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          ".indexOn": [
            "createdAtMs",
            "expiresAtMs"
          ],
          "$pingId": {
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists() && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && data.child('createdBy').val() == auth.uid))",
            ".validate": "!newData.exists() || (newData.hasChildren(['lat', 'lon', 'createdAtMs', 'createdBy', 'expiresAtMs']) && newData.child('lat').isNumber() && newData.child('lat').val() >= -90 && newData.child('lat').val() <= 90 && newData.child('lon').isNumber() && newData.child('lon').val() >= -180 && newData.child('lon').val() <= 180 && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid && newData.child('expiresAtMs').isNumber() && newData.child('expiresAtMs').val() > newData.child('createdAtMs').val() && newData.child('expiresAtMs').val() <= newData.child('createdAtMs').val() + 600000 && (!newData.child('updatedAtMs').exists() || (newData.child('updatedAtMs').isNumber() && newData.child('updatedAtMs').val() >= newData.child('createdAtMs').val())) && (!newData.child('state').exists() || (newData.child('state').val() == 'ACTIVE' || newData.child('state').val() == 'EXPIRED' || newData.child('state').val() == 'DISABLED')) && (!newData.child('scope').exists() || newData.child('scope').val() == 'TEAM_EVENT') && (!newData.child('kind').exists() || newData.child('kind').val() == 'ENEMY_PING') && (!newData.child('type').exists() || (newData.child('type').val() == 'ATTACK' || newData.child('type').val() == 'DEFENSE' || newData.child('type').val() == 'DANGER')) && ((!data.exists() && newData.child('createdBy').val() == auth.uid) || (data.exists() && newData.child('createdBy').val() == data.child('createdBy').val() && newData.child('createdAtMs').val() == data.child('createdAtMs').val())))"
          }
        },
        "commands": {
          ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
          "active": {
            ".read": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['id', 'type', 'createdAtMs', 'createdBy']) && newData.child('id').isString() && newData.child('id').val().length > 0 && newData.child('id').val().length <= 64 && newData.child('type').isString() && (newData.child('type').val() == 'RALLY' || newData.child('type').val() == 'RETREAT' || newData.child('type').val() == 'ATTACK') && newData.child('createdAtMs').isNumber() && newData.child('createdBy').isString() && newData.child('createdBy').val() == auth.uid)"
          }
        },
        "memberPrefs": {
          "$uid": {
            ".read": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".write": "auth != null && auth.uid == $uid && root.child('teams').child($teamCode).child('members').child(auth.uid).exists()",
            ".validate": "!newData.exists() || (newData.hasChildren(['preset', 'nearRadiusM', 'showDead', 'showStale', 'focusMode', 'updatedAtMs']) && newData.child('preset').isString() && (newData.child('preset').val() == 'ALL' || newData.child('preset').val() == 'SOS' || newData.child('preset').val() == 'NEAR' || newData.child('preset').val() == 'ACTIVE') && newData.child('nearRadiusM').isNumber() && newData.child('nearRadiusM').val() >= 50 && newData.child('nearRadiusM').val() <= 500 && newData.child('showDead').isBoolean() && newData.child('showStale').isBoolean() && newData.child('focusMode').isBoolean() && newData.child('updatedAtMs').isNumber() && (!data.exists() || newData.child('updatedAtMs').val() >= data.child('updatedAtMs').val()))"
          }
        }
      }
    }
  }
}

