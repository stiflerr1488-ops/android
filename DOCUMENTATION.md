# TeamCompass ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

**–í–µ—Ä—Å–∏—è:** 0.2.1  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 25 —Ñ–µ–≤—Ä–∞–ª—è 2026 (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Android (API 26‚Äì36)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—É–¥–∏—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
**Firebase Project:** `sk-grom` (Project Number: `290208390931`)

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û –ø—Ä–æ–µ–∫—Ç–µ](#1-–æ-–ø—Ä–æ–µ–∫—Ç–µ)
2. [–î–ª—è –∫–æ–≥–æ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](#2-–¥–ª—è-–∫–æ–≥–æ-—ç—Ç–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
3. [–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#3-–∫–ª—é—á–µ–≤—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
4. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#4-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#5-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
6. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é](#6-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-–æ–∫—Ä—É–∂–µ–Ω–∏—é)
7. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#7-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
8. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase](#8-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-firebase)
9. [–ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞](#9-–∫–æ–º–∞–Ω–¥—ã-—Å–±–æ—Ä–∫–∏-–∏-–∑–∞–ø—É—Å–∫–∞)
10. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏](#10-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-—Å–±–æ—Ä–∫–∏)
11. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#11-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
12. [–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö RTDB](#12-—Å—Ö–µ–º–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö-rtdb)
13. [–ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firebase](#13-–ø—Ä–∞–≤–∏–ª–∞-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-firebase)
14. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å join-–∫–æ–¥–∞](#14-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-join-–∫–æ–¥–∞)
15. [–†–∞–∑—Ä–µ—à–µ–Ω–∏—è Android](#15-—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è-android)
16. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#16-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
17. [CI/CD](#17-cicd)
18. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞](#18-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-–∞—É–¥–∏—Ç–∞)
19. [–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è](#19-–∏–∑–≤–µ—Å—Ç–Ω—ã–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
20. [Changelog](#20-changelog)
21. [Roadmap](#21-roadmap)
22. [Troubleshooting](#22-troubleshooting)
23. [–ì–ª–æ—Å—Å–∞—Ä–∏–π](#23-–≥–ª–æ—Å—Å–∞—Ä–∏–π)
24. [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#24-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

---

## 1. –û –ø—Ä–æ–µ–∫—Ç–µ

**TeamCompass** ‚Äî Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å—Ç—Ä–∞–π–∫–±–æ–ª–∏—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–º–æ–≥–∞–µ—Ç –∫–æ–º–∞–Ω–¥–µ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–ª–∏–≥–æ–Ω–µ: –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏—Ö, –±—ã—Å—Ç—Ä–æ –æ—Ç–º–µ—á–∞—Ç—å —É–≥—Ä–æ–∑—ã –∏ –¥–µ—Ä–∂–∞—Ç—å –æ–±—â–∏–π —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

### –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

- **Realtime –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è** ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–¢–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –º–µ—Ç–∫–∏, enemy pings, –∫–æ–º–∞–Ω–¥–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- **Situational awareness** ‚Äî –æ–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –±–æ—è –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- **–ú–∏–Ω–∏–º—É–º —Ä—É—á–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ Firebase

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- ‚úÖ **Correctness > Speed** ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–¥ —Å–∫–æ—Ä–æ—Å—Ç—å—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **Radar-first UX** ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–¥–∞—Ä, –ø–æ—Ç–æ–º –∫–∞—Ä—Ç–∞
- ‚úÖ **Degraded mode UX** ‚Äî —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏
- ‚úÖ **Security by design** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Firebase Rules

---

## 2. –î–ª—è –∫–æ–≥–æ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------------|------------------------|
| **–ö–æ–º–∞–Ω–¥—ã —Å—Ç—Ä–∞–π–∫–±–æ–ª–∏—Å—Ç–æ–≤** | –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∏–≥—Ä—ã, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è |
| **–ö–∞–ø–∏—Ç–∞–Ω—ã/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã** | –ë—ã—Å—Ç—Ä—ã–π situational awareness, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π |
| **–ò–≥—Ä–æ–∫–∏** | –ü—Ä–æ—Å—Ç–æ—Ç–∞, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –º–∏–Ω–∏–º—É–º ¬´—Ä—É—á–Ω–æ–π¬ª –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ |
| **–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö–æ–¥–∞ –∏–≥—Ä—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 3.1 –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-------------|----------|------------|
| üéØ **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã** | 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥, Firebase Anonymous Auth | `SessionCoordinator` |
| üß≠ **–û–±—â–∏–π —Ä–∞–¥–∞—Ä/–∫–æ–º–ø–∞—Å** | –ü–æ–∑–∏—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ | `CompassScreen` + `FirebaseTeamRepository` |
| üë§ **–†–µ–∂–∏–º—ã –∏–≥—Ä–æ–∫–∞** | `GAME` / `DEAD` —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ | `PlayerMode` enum, UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è |
| üÜò **SOS-—Å–∏–≥–Ω–∞–ª** | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã | `sosUntilMs` field, `EventNotificationManager` |
| üìç **–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏** | –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ | `points`, `privatePoints` –≤ RTDB |
| ‚öîÔ∏è **Enemy ping** | –ë—ã—Å—Ç—Ä–æ–µ –æ—Ç–º–µ—á–∞–Ω–∏–µ —É–≥—Ä–æ–∑ (`ATTACK`, `DEFENSE`, `DANGER`) | `enemyPings` —Å TTL 600s |
| üó∫Ô∏è **–ö–∞—Ä—Ç—ã** | –ò–º–ø–æ—Ä—Ç KMZ/KML, —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π | `KmzMapImporter`, `FullscreenMapScreen` |
| üì∂ **BLE-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ | `BluetoothScanner`, `BluetoothScanCoordinator` |
| üìä **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | Backend health monitoring, stale data –∏–Ω–¥–∏–∫–∞—Ü–∏—è | `BackendHealthMonitor`, `TeamSnapshotObserver` |
| üîÜ **–ê–≤—Ç–æ—è—Ä–∫–æ—Å—Ç—å** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | `ScreenAutoBrightness`, `AutoBrightnessBinding` |

### 3.2 –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (v0.2.1)

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Backend health monitoring** | Periodic probe Firebase RTDB (10s interval), UI banner –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ |
| **Stale data detection** | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—à–µ 30 —Å–µ–∫—É–Ω–¥ |
| **Exponential backoff reconnect** | –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (max 20s cap) |
| **SavedStateHandle** | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ state –ø–æ—Å–ª–µ process death |
| **State cells cache** | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è reads –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥ (5,000 entries max) |
| **Performance metrics** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ RTDB emits, cleanup sweeps, map cache hits |

---

## 4. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### 4.1 –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|--------|------------|
| **–Ø–∑—ã–∫** | Kotlin | 2.3.10 | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **UI** | Jetpack Compose + Material 3 | BOM 2026.02.00 | –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π UI |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | MVVM + Repository + Coordinator | ‚Äî | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |
| **DI** | Hilt | 2.59.2 | Dependency Injection |
| **Backend** | Firebase Anonymous Auth + RTDB | BOM 34.9.0 | Realtime –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **–ö–æ—Ä—É—Ç–∏–Ω—ã** | Kotlinx Coroutines | 1.10.2 | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å |
| **Flow** | StateFlow + SharedFlow | ‚Äî | Reactive streams |
| **–ù–∞–≤–∏–≥–∞—Ü–∏—è** | Navigation Compose | 2.9.7 | –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | DataStore Preferences | 1.2.0 | –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** | Google Play Services Location | 21.3.0 | GPS/Network location |
| **–§–æ–Ω** | Foreground Service (location) | ‚Äî | –§–æ–Ω–æ–≤–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ |

### 4.2 Build-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **Android Gradle Plugin** | 9.0.1 | –°–±–æ—Ä–∫–∞ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **Kotlin Plugin** | 2.3.10 | –ö–æ–º–ø–∏–ª—è—Ü–∏—è Kotlin |
| **KSP** | (–≤—Å—Ç—Ä–æ–µ–Ω –≤ Kotlin) | Kotlin Symbol Processing |
| **Compose Plugin** | 2.3.10 | –ö–æ–º–ø–∏–ª—è—Ü–∏—è Compose |
| **Google Services** | 4.4.4 | Firebase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |
| **Firebase Crashlytics** | 3.0.6 | –ö—Ä–∞—à-—Ä–µ–ø–æ—Ä—Ç–∏–Ω–≥ |

### 4.3 –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **JUnit** | 4.13.2 | Unit —Ç–µ—Å—Ç—ã |
| **Kotlinx Coroutines Test** | 1.10.2 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—É—Ç–∏–Ω |
| **AndroidX Test Core** | 1.7.0 | Test utilities |
| **Robolectric** | 4.16.1 | Unit —Ç–µ—Å—Ç—ã —Å Android SDK |
| **AndroidX Test Runner** | 1.7.0 | Android Test Runner |
| **Compose UI Test** | (–∏–∑ BOM) | Compose UI —Ç–µ—Å—Ç—ã |
| **AndroidX Test Ext JUnit** | 1.3.0 | JUnit —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è |
| **Espresso Core** | 3.7.0 | UI —Ç–µ—Å—Ç—ã |

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 5.1 –î–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤

```
android/
‚îú‚îÄ‚îÄ app/                              # Android runtime –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/com/example/teamcompass/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                     # Firebase Auth, IdentityLinkingService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bluetooth/                # BLE scanner, BluetoothDevice
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ firebase/             # FirebaseTeamRepository, RealtimeBackendClient
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ di/                       # Hilt modules (SingletonComponent)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/                   # TeamRepository, TrackingController, roles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ p2p/                      # P2P transports (BLE, LoRa bridge)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ perf/                     # Performance metrics
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tracking/                 # TrackingRuntime, TrackingControllerImpl
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ components/           # Reusable Compose components
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dialogs/              # Dialog implementations
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ theme/                # Theme, colors, typography
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ *.kt                  # Screens, ViewModel, Coordinators
‚îÇ   ‚îú‚îÄ‚îÄ src/androidTest/              # Instrumentation —Ç–µ—Å—Ç—ã (16 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ src/debug/                    # Debug-specific code
‚îÇ   ‚îú‚îÄ‚îÄ src/test/                     # Unit —Ç–µ—Å—Ç—ã (~40 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ src/main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/                   # SVG –∏–∫–æ–Ω–∫–∏, KMZ –∫–∞—Ä—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ res/                      # Resources, layouts, drawables
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AndroidManifest.xml       # Manifest —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ build.gradle.kts              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è app –º–æ–¥—É–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ proguard-rules.pro            # Proguard –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è release
‚îÇ   ‚îî‚îÄ‚îÄ lint-baseline.xml             # Lint baseline
‚îÇ
‚îú‚îÄ‚îÄ core/                             # Pure Kotlin –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/.../core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ p2p/                      # P2P models, security, chunker
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ *.kt                      # GeoMath, Models, Policies, Validators
‚îÇ   ‚îú‚îÄ‚îÄ src/test/kotlin/.../core/     # Core unit —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle.kts              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è core –º–æ–¥—É–ª—è
‚îÇ
‚îú‚îÄ‚îÄ .agents/                          # Qwen agent skills (–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
‚îú‚îÄ‚îÄ .codex/                           # ChatGPT extension configs
‚îú‚îÄ‚îÄ .continue/                        # Continue.dev configs
‚îú‚îÄ‚îÄ .github/workflows/                # CI/CD workflow
‚îÇ   ‚îú‚îÄ‚îÄ ci.yml                        # –û—Å–Ω–æ–≤–Ω–æ–π CI pipeline
‚îÇ   ‚îî‚îÄ‚îÄ nightly-release-smoke.yml     # Nightly release —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ .githooks/                        # Git hooks (UTF-8 check)
‚îú‚îÄ‚îÄ .vscode/                          # VS Code settings
‚îú‚îÄ‚îÄ tools/                            # Scripts (icons, checks, CI helpers)
‚îÇ   ‚îú‚îÄ‚îÄ ci/                           # CI scripts (Python, Shell)
‚îÇ   ‚îú‚îÄ‚îÄ export_icons.ps1              # –°–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏–∫–æ–Ω–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ README_ICON.md                # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏–∫–æ–Ω–∫–∞–º
‚îÇ
‚îú‚îÄ‚îÄ DOCUMENTATION.md                  # –≠–¢–û–¢ —Ñ–∞–π–ª ‚Äî –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ README.md                         # –ö—Ä–∞—Ç–∫–∏–π README —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ DOCUMENTATION.md
‚îú‚îÄ‚îÄ firebase-database.rules.json      # Security rules –¥–ª—è RTDB
‚îú‚îÄ‚îÄ firebase.json                     # Firebase emulators config
‚îú‚îÄ‚îÄ build.gradle.kts                  # Root build (plugin versions)
‚îú‚îÄ‚îÄ gradle.properties                 # Gradle JVM –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Ñ–ª–∞–≥–∏
‚îî‚îÄ‚îÄ gradle/wrapper/                   # Gradle wrapper
```

### 5.2 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (app)** | ~15,000 |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (core)** | ~3,000 |
| **–¢–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | 56 (unit + instrumentation) |
| **Compose screens** | 6 –æ—Å–Ω–æ–≤–Ω—ã—Ö |
| **Coordinators** | 4 (Session, Tracking, Map, Alerts) |
| **P2P transports** | 2 (BLE, LoRa bridge) |
| **Instrumentation —Ç–µ—Å—Ç–æ–≤** | 16 —Ñ–∞–π–ª–æ–≤ |
| **Unit —Ç–µ—Å—Ç–æ–≤** | ~40 —Ñ–∞–π–ª–æ–≤ |

---

## 6. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é

### 6.1 –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------------|--------|------------|
| **Android Studio** | Iguana/Koala+ | –ò–ª–∏ CLI-—Å–±–æ—Ä–∫–∞ |
| **JDK** | 17+ | JDK 21 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **Android SDK** | API 26‚Äì36 | minSdk = 26, targetSdk = 36 |
| **RAM** | 8 –ì–ë | –ú–∏–Ω–∏–º—É–º –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **Disk** | 10 –ì–ë | –î–ª—è SDK, Gradle cache, build artifacts |

### 6.2 Firebase —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|--------|------------|
| **Authentication** | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | Anonymous Auth –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| **Realtime Database** | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã |
| **Crashlytics** | ‚ö™ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –ö—Ä–∞—à-—Ä–µ–ø–æ—Ä—Ç–∏–Ω–≥ |
| **Analytics** | ‚ö™ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |

### 6.3 Firebase CLI

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º—É–ª—è—Ç–æ—Ä–∞–º–∏ –∏ –¥–µ–ø–ª–æ–µ–º –ø—Ä–∞–≤–∏–ª:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Firebase CLI
npm install -g firebase-tools@14.22.0

# –õ–æ–≥–∏–Ω
firebase login

# –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
firebase projects:list

# –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã
firebase use sk-grom
```

---

## 7. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 7.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

**–®–∞–≥ 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω**

```powershell
# Windows PowerShell
Copy-Item app/google-services.json.example app/google-services.json

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ app/google-services.json.example –≤ app/google-services.json
```

**–®–∞–≥ 2: –ó–∞–º–µ–Ω–∏—Ç—å placeholder'—ã**

–û—Ç–∫—Ä–æ–π—Ç–µ `app/google-services.json` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:
- `YOUR_FIREBASE_PROJECT_ID` –Ω–∞ `sk-grom`
- `YOUR_PROJECT_NUMBER` –Ω–∞ `290208390931`
- `YOUR_API_KEY` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á –∏–∑ Firebase Console

**–®–∞–≥ 3: –°–∫–∞—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `sk-grom`
3. Settings ‚Üí Your apps ‚Üí Android app
4. Download `google-services.json`
5. –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ `app/google-services.json`

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `app/google-services.json` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!

### 7.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RTDB URL

**–°–ø–æ—Å–æ–± 1: local.properties**

```properties
# –°–æ–∑–¥–∞–π—Ç–µ/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ local.properties –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
TEAMCOMPASS_RTDB_URL=https://sk-grom-default-rtdb.europe-west1.firebasedatabase.app
```

**–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ -P —Ñ–ª–∞–≥**

```bash
./gradlew assembleDebug -PTEAMCOMPASS_RTDB_URL=https://sk-grom-default-rtdb.europe-west1.firebasedatabase.app
```

**–°–ø–æ—Å–æ–± 3: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
export TEAMCOMPASS_RTDB_URL=https://sk-grom-default-rtdb.europe-west1.firebasedatabase.app
./gradlew assembleDebug
```

### 7.3 –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# 1. Debug APK
./gradlew :app:assembleDebug

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
./gradlew :app:installDebug

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
adb shell am start -n com.example.teamcompass/.MainActivity

# 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
adb logcat -s TeamCompass

# 5. –û—á–∏—Å—Ç–∫–∞ –∏ —Å–±–æ—Ä–∫–∞
./gradlew clean :app:assembleDebug
```

### 7.4 Pre-merge –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

```bash
# Baseline gates (compile + test)
./gradlew :app:compileDebugKotlin :core:test :app:testDebugUnitTest :app:compileDebugAndroidTestKotlin

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./gradlew check

# Lint
./gradlew :app:lintDebug
```

---

## 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

### 8.1 –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Project ID** | `sk-grom` |
| **Project Number** | `290208390931` |
| **Account** | stiflerr.1488@gmail.com |
| **RTDB URL** | `https://sk-grom-default-rtdb.europe-west1.firebasedatabase.app` |

### 8.2 –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Firebase –ø—Ä–æ–µ–∫—Ç (–µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω)**

```bash
firebase projects:create
```

**–®–∞–≥ 2: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

1. Firebase Console ‚Üí Project Settings ‚Üí Your apps ‚Üí Add app
2. Package name: `com.example.teamcompass`
3. App nickname: `TeamCompass`
4. Download `google-services.json`

**–®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç—å SHA-1 –∫–ª—é—á (–¥–ª—è debug)**

```bash
# Windows PowerShell
keytool -list -v -keystore "$env:USERPROFILE\.android\debug.keystore" -alias androiddebugkey -storepass android -keypass android

# Linux/macOS
keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android
```

**–®–∞–≥ 4: –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –≤ Firebase Console**

1. **Authentication** ‚Üí Sign-in method ‚Üí Anonymous ‚Üí Enable
2. **Realtime Database** ‚Üí Create database ‚Üí Start in test mode (–∏–ª–∏ —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞)

**–®–∞–≥ 5: –î–µ–ø–ª–æ–π –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
firebase use sk-grom

# –î–µ–ø–ª–æ–π –ø—Ä–∞–≤–∏–ª –≤ Firebase
firebase deploy --only database

# –î–µ–ø–ª–æ–π –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
firebase deploy
```

**–®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —ç–º—É–ª—è—Ç–æ—Ä—ã Auth + Database
firebase emulators:start --only auth,database

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å —ç–º—É–ª—è—Ç–æ—Ä–∞–º–∏
npx firebase-tools@14.22.0 emulators:exec \
  --project demo-teamcompass \
  --only auth,database \
  "gradlew.bat :app:connectedDebugAndroidTest -PandroidTestClass=com.example.teamcompass.FirebaseRulesEmulatorTest"
```

### 8.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Firebase –ø—Ä–æ–µ–∫—Ç–∞

```
Firebase Project: sk-grom
‚îú‚îÄ‚îÄ Authentication
‚îÇ   ‚îî‚îÄ‚îÄ Anonymous Auth (–≤–∫–ª—é—á–µ–Ω–æ)
‚îú‚îÄ‚îÄ Realtime Database
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/meta
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/members/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/memberRoles/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/state/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/stateCells/{cellId}/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/points/{pointId}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/privatePoints/{uid}/{pointId}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/enemyPings/{pingId}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/rateLimits/enemyPing/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ /teams/{teamCode}/commands/active
‚îÇ   ‚îî‚îÄ‚îÄ /teams/{teamCode}/memberPrefs/{uid}
‚îú‚îÄ‚îÄ Crashlytics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ Analytics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## 9. –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

### 9.1 –û—Å–Ω–æ–≤–Ω–∞—è —Å–±–æ—Ä–∫–∞

```bash
# Debug APK (–±—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞)
./gradlew :app:assembleDebug

# Release APK (—Å Proguard/R8)
./gradlew :app:assembleRelease

# –û—á–∏—Å—Ç–∫–∞ –∏ —Å–±–æ—Ä–∫–∞
./gradlew clean :app:assembleDebug

# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
./gradlew build
```

### 9.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å debug –≤–µ—Ä—Å–∏—é
./gradlew :app:installDebug

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
$env:ANDROID_SERIAL="<device-serial>"
./gradlew :app:installDebug

# Install + –∑–∞–ø—É—Å–∫
./gradlew :app:installDebug && adb shell am start -n com.example.teamcompass/.MainActivity

# Uninstall
./gradlew :app:uninstallAll
```

### 9.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Pre-merge baseline (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
./gradlew :app:compileDebugKotlin :core:test :app:testDebugUnitTest :app:compileDebugAndroidTestKotlin

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./gradlew check

# Unit —Ç–µ—Å—Ç—ã
./gradlew :core:test :app:testDebugUnitTest

# Instrumentation —Ç–µ—Å—Ç—ã
./gradlew :app:connectedDebugAndroidTest

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestClass=com.example.teamcompass.TeamCompassSmokeTest" \
  "-PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"

# Lint
./gradlew :app:lintDebug
```

### 9.4 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Logcat —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ —Ç–µ–≥—É
adb logcat -s TeamCompass

# Logcat —Å timestamp
adb logcat -v time

# Logcat —Å —Ü–≤–µ—Ç–æ–º (—á–µ—Ä–µ–∑ pidcat)
pidcat com.example.teamcompass

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
adb logcat -c

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª
adb logcat -d > logs.txt
```

### 9.5 –û—Ç–ª–∞–¥–∫–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
adb devices

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å adb server
adb kill-server && adb start-server

# –°–∫—Ä–∏–Ω—à–æ—Ç
adb shell screencap -p /sdcard/screen.png && adb pull /sdcard/screen.png

# –ó–∞–ø–∏—Å–∞—Ç—å —ç–∫—Ä–∞–Ω
adb shell screenrecord /sdcard/demo.mp4

# –ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥cat
adb logcat -d > bugreport.txt
```

---

## 10. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏

### 10.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (low-load)

**–§–∞–π–ª:** `gradle.properties`

```properties
# JVM –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è Gradle
org.gradle.jvmargs=-Xmx2048m -XX:MaxMetaspaceSize=512m -Dfile.encoding=UTF-8 -XX:+UseG1GC -XX:SoftRefLRUPolicyMSPerMB=50

# Daemon mode
org.gradle.daemon=true

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
org.gradle.caching=true

# –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (–æ—Ç–∫–ª—é—á—ë–Ω –¥–ª—è low-load)
org.gradle.parallel=false

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∫—ç—à
org.gradle.configuration-cache=true
org.gradle.configuration-cache.problems=warn
org.gradle.configureondemand=true

# –ú–∞–∫—Å–∏–º—É–º workers
org.gradle.workers.max=1

# Kotlin –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
kotlin.incremental=true
ksp.incremental=true
kotlin.compiler.execution.strategy=out-of-process
kotlin.daemon.jvmargs=-Xmx768m -XX:MaxMetaspaceSize=256m
```

### 10.2 –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ö–æ–º–∞–Ω–¥–∞ | –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM |
|----------|---------|--------------|-------------------|
| **Low-load (default)** | `./gradlew :app:compileDebugKotlin` | ~2-3 –º–∏–Ω | ~4-5 –ì–ë |
| **Extra-low load** | `./gradlew :app:compileDebugKotlin --max-workers=1` | ~4-5 –º–∏–Ω | ~3-4 –ì–ë |
| **Faster (–∫–æ–≥–¥–∞ –ü–ö —Å–≤–æ–±–æ–¥–µ–Ω)** | `./gradlew :app:compileDebugKotlin --max-workers=4` | ~1-2 –º–∏–Ω | ~6-7 –ì–ë |
| **Release smoke check** | `./gradlew :app:assembleRelease --max-workers=2` | ~5-7 –º–∏–Ω | ~5-6 –ì–ë |

### 10.3 –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Gradle –¥–µ–º–æ–Ω—ã
./gradlew --stop

# –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
./gradlew clean

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
rm -rf .gradle/ build/ app/build/ core/build/

# –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
./clean_gradle_cache.bat
```

### 10.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 8 –ì–ë RAM

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤—Å–µ 8 –ì–ë –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ—É—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –ª–∞–≥–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å low-load –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (—É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ `gradle.properties`)
2. **–ó–∞–∫—Ä—ã—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –ø–µ—Ä–µ–¥ –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏:**
   ```bash
   ./clean_ram_before_build.bat
   ```
4. **–ó–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:**
   ```bash
   ./build_limited.bat
   ```

### 10.5 CI –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**CI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç local):

```properties
# –í .github/workflows/ci.yml
GRADLE_OPTS: -Dorg.gradle.workers.max=4 -Dorg.gradle.parallel=true
```

**–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –≤ CI:**
- Baseline compile: ~10-15 –º–∏–Ω
- Unit tests: ~5-7 –º–∏–Ω
- Lint: ~3-5 –º–∏–Ω
- Instrumentation tests: ~20-30 –º–∏–Ω (–Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ)

---

## 11. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 11.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–∏–ª—å

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **MVVM + Repository + Coordinator decomposition**.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   UI Layer (Compose)                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ            TeamCompassViewModel                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - State management (StateFlow)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - User actions handling                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Lifecycle awareness                            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  Session     ‚îÇ ‚îÇ   Tracking   ‚îÇ ‚îÇ     Map      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Coordinator ‚îÇ ‚îÇ  Coordinator ‚îÇ ‚îÇ  Coordinator ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Domain Layer (Interfaces)                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ TeamRepository   ‚îÇ    ‚îÇ TrackingController   ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               Data Layer (Implementation)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ         FirebaseTeamRepository                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - RealtimeDatabase callbacks                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - callbackFlow –¥–ª—è observe                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Security rules validation                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 11.2 –ì—Ä–∞–Ω–∏—Ü—ã –º–æ–¥—É–ª–µ–π

| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|--------|------------|-------------|
| **app** | Android runtime, UI, Firebase integration | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç core |
| **core** | Pure Kotlin: –º–æ–¥–µ–ª–∏, –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ø–æ–ª–∏—Ç–∏–∫–∏ | –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç Android |

### 11.3 –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### UI Layer (`app/ui`)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|----------------|
| **Compose screens** | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ state, user interaction |
| **TeamCompassViewModel** | –§–∞—Å–∞–¥ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API —ç–∫—Ä–∞–Ω–∞, state management |
| **Coordinators** | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º |

**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—ã:**

| –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä | –ó–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|---------------------|
| **SessionCoordinator** | Auth, create/join team, leave team, listening |
| **TrackingCoordinator** | Tracking policies, location/heading monitor, watchdog |
| **MapCoordinator** | KMZ/KML import/save, marker CRUD, overlays |
| **AlertsCoordinator** | SOS, enemy pings, notification policies |
| **TargetFilterCoordinator** | Filter presets, radius, focus mode |
| **LocationReadinessCoordinator** | Permission checks, service readiness |
| **BackendAvailabilityCoordinator** | Backend health monitoring |
| **BluetoothScanCoordinator** | BLE device discovery |
| **MapActionsCoordinator** | Map interactions |
| **TacticalActionsCoordinator** | Tactical actions (enemy pings, commands) |

#### Domain Layer

| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| **TeamRepository** | –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–æ–º–∞–Ω–¥–æ–π |
| **TrackingController** | –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ |

#### Data Layer

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|----------------|
| **FirebaseTeamRepository** | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è TeamRepository –Ω–∞ Firebase RTDB |
| **RealtimeBackendClient** | Low-level RTDB operations, health probing |
| **TrackingControllerImpl** | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è TrackingController |
| **TrackingRuntime** | Runtime –ª–æ–≥–∏–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è |

#### Android Runtime

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| **TeamCompassApplication** | Bootstrap runtime, telemetry toggles, memory trim |
| **TrackingService** | Foreground location tracking service |
| **MainActivity** | Main entry point, splash screen, fullscreen mode |
| **HiltModules** | DI configuration (SingletonComponent) |

### 11.4 Data-flow –¥–∏–∞–≥—Ä–∞–º–º—ã

#### 11.4.1 Create/Join Team

```
User action (UI)
    ‚Üì
ViewModel.createTeam() / joinTeam(code)
    ‚Üì
SessionCoordinator
    ‚Üì
TeamRepository.createTeam(uid, callsign) / joinTeam(code, uid, callsign)
    ‚Üì
FirebaseTeamRepository
    ‚Üì
Firebase RTDB (transaction)
    ‚Üì
Result ‚Üí Domain error mapping ‚Üí UI state/event
```

**–í–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ FirebaseTeamRepository:**

- ‚úÖ Team code: —Å—Ç—Ä–æ–≥–æ `^\d{6}$`
- ‚úÖ `joinSalt` required (hex 16‚Äì128)
- ‚úÖ `joinHash` required (hex 64)
- ‚úÖ Mismatch hash ‚Üí `NOT_FOUND` (–±–µ–∑ —É—Ç–µ—á–∫–∏)
- ‚úÖ `isLocked` check ‚Üí `LOCKED`
- ‚úÖ `expiresAtMs` check ‚Üí `EXPIRED`

#### 11.4.2 Observe Team Snapshot

```
ViewModel.startListening()
    ‚Üì
teamSessionDelegate.observeTeam(teamCode)
    ‚Üì
FirebaseTeamRepository.observeTeam()
    ‚Üì
callbackFlow {
    ValueEventListener.onChildAdded/Changed/Removed
    awaitClose { removeEventListener }
}
    ‚Üì
TeamSnapshotObserver (retry policy, exponential backoff)
    ‚Üì
Debounce emit (75ms)
    ‚Üì
Incremental collections (–±–µ–∑ full sort –Ω–∞ –∫–∞–∂–¥—ã–π event)
    ‚Üì
UI state update (StateFlow)
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

- ‚úÖ Debounce snapshot emits
- ‚úÖ –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–±–µ–∑ –ø–æ–ª–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
- ‚úÖ Cleanup expired enemy pings —Ä–µ–¥–∫–∏–º sweep (–Ω–µ –≤ hot path)
- ‚úÖ State cells cache (5,000 entries max)

#### 11.4.3 Tracking Runtime

```
User enables tracking
    ‚Üì
ViewModel.startTracking(mode)
    ‚Üì
TrackingController.startTracking(config)
    ‚Üì
TrackingService.startForeground()
    ‚Üì
TrackingRuntime.ensureScope()
    ‚Üì
LocationUpdates (FusedLocationProvider)
    ‚Üì
TrackingPolicy.shouldSendState(location, prevLocation, timestamp)
    ‚Üì
TeamRepository.updateState(teamCode, uid, statePayload)
    ‚Üì
Firebase RTDB (/state/{uid} –∏–ª–∏ /stateCells/{cellId}/{uid})
```

**Policy checks:**

- ‚úÖ Interval-based (GAME: 2s, SILENT: 12s)
- ‚úÖ Distance-based (min 15m –¥–ª—è SILENT)
- ‚úÖ Stagnation watchdog (restart –µ—Å–ª–∏ –Ω–µ—Ç updates)
- ‚úÖ Max restarts limiting (3 restarts, –∑–∞—Ç–µ–º pause 15s)

#### 11.4.4 Backend Health Monitoring

```
ViewModel.initialize()
    ‚Üì
BackendHealthDelegate.startHealthMonitor(scope)
    ‚Üì
Periodic probe (10s interval)
    ‚Üì
FirebaseTeamRepository.probeBackendHealth()
    ‚Üì
ValueEventListener.addValueEventListener (probe path)
    ‚Üì
Timeout (1.25s) ‚Üí failure count
    ‚Üì
Failure threshold (6) ‚Üí backend down
    ‚Üì
UI state update (backendAvailable = false)
    ‚Üì
User sees banner + degraded mode
```

**Stale data detection:**

- ‚úÖ Last snapshot timestamp tracked
- ‚úÖ Stale warning threshold: 30s
- ‚úÖ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "stale data" banner

### 11.5 Coroutine Scope Ownership

**TeamCompassViewModel –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—ã:**

- `BackendAvailabilityCoordinator.scope` ‚Üí `viewModelScope`
- `BluetoothScanCoordinator.scope` ‚Üí `viewModelScope`
- `MapActionsCoordinator.scope` ‚Üí `viewModelScope`
- `TacticalActionsCoordinator.scope` ‚Üí `viewModelScope`

**TrackingRuntime lifecycle:**

- `TrackingRuntime` owns its internal `CoroutineScope`
- `TrackingRuntime.stop()` cancels child jobs
- `TrackingRuntime.close()` cancels the whole scope
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `TrackingControllerImpl.onServiceDestroyed()`
- –ö–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `TrackingService.onDestroy()`

**–≠—Ç–æ –∏–Ω—Ç–µ–Ω—Å–∏–æ–Ω–∞–ª—å–Ω–æ:** tracking runtime ‚Äî service-owned, –Ω–µ ViewModel-owned.

---

## 12. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö RTDB

### 12.1 –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞

```
/teams/{teamCode}/
‚îú‚îÄ‚îÄ meta/
‚îÇ   ‚îú‚îÄ‚îÄ createdAtMs          ‚Üê number, timestamp —Å–æ–∑–¥–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ expiresAtMs          ‚Üê number, timestamp –∏—Å—Ç–µ—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ createdBy            ‚Üê string, UID —Å–æ–∑–¥–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ isLocked             ‚Üê boolean, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ joinSalt             ‚Üê string, hex 16‚Äì128 —Å–∏–º–≤–æ–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ joinHash             ‚Üê string, hex 64 —Å–∏–º–≤–æ–ª–∞ (SHA-256)
‚îÇ
‚îú‚îÄ‚îÄ members/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ callsign             ‚Üê string, 1‚Äì24 —Å–∏–º–≤–æ–ª–∞
‚îÇ   ‚îî‚îÄ‚îÄ joinedAtMs           ‚Üê number, timestamp –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ memberRoles/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ commandRole          ‚Üê string: SIDE_COMMANDER, COMPANY_COMMANDER, PLATOON_COMMANDER, TEAM_COMMANDER, TEAM_DEPUTY, FIGHTER
‚îÇ   ‚îú‚îÄ‚îÄ combatRole           ‚Üê string: NONE, ASSAULTER, SCOUT, SNIPER, MORTAR
‚îÇ   ‚îú‚îÄ‚îÄ vehicleRole          ‚Üê string: NONE, DRIVER, ASSISTANT_DRIVER, PASSENGER
‚îÇ   ‚îú‚îÄ‚îÄ sideId               ‚Üê string, ID —Å—Ç–æ—Ä–æ–Ω—ã (1‚Äì32)
‚îÇ   ‚îú‚îÄ‚îÄ companyId            ‚Üê string?, ID —Ä–æ—Ç—ã (1‚Äì32)
‚îÇ   ‚îú‚îÄ‚îÄ platoonId            ‚Üê string?, ID –≤–∑–≤–æ–¥–∞ (1‚Äì32)
‚îÇ   ‚îú‚îÄ‚îÄ teamId               ‚Üê string?, ID –æ—Ç–¥–µ–ª–µ–Ω–∏—è (1‚Äì32)
‚îÇ   ‚îú‚îÄ‚îÄ vehicleId            ‚Üê string?, ID —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (1‚Äì32)
‚îÇ   ‚îú‚îÄ‚îÄ callsign             ‚Üê string?, –ø–æ–∑—ã–≤–Ω–æ–π (‚â§24)
‚îÇ   ‚îú‚îÄ‚îÄ updatedBy            ‚Üê string?, UID –æ–±–Ω–æ–≤–∏–≤—à–µ–≥–æ
‚îÇ   ‚îî‚îÄ‚îÄ updatedAtMs          ‚Üê number, timestamp –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ state/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ callsign             ‚Üê string, 1‚Äì24 —Å–∏–º–≤–æ–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ lat                  ‚Üê number, -90..90
‚îÇ   ‚îú‚îÄ‚îÄ lon                  ‚Üê number, -180..180
‚îÇ   ‚îú‚îÄ‚îÄ acc                  ‚Üê number, —Ç–æ—á–Ω–æ—Å—Ç—å (–º)
‚îÇ   ‚îú‚îÄ‚îÄ speed                ‚Üê number, —Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)
‚îÇ   ‚îú‚îÄ‚îÄ heading              ‚Üê number?, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (0‚Äì360)
‚îÇ   ‚îú‚îÄ‚îÄ ts                   ‚Üê number, timestamp (‚â§ now + 60000)
‚îÇ   ‚îú‚îÄ‚îÄ mode                 ‚Üê string: 'GAME' –∏–ª–∏ 'DEAD'
‚îÇ   ‚îú‚îÄ‚îÄ anchored             ‚Üê boolean, –∑–∞–∫—Ä–µ–ø–ª—ë–Ω –ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ sosUntilMs           ‚Üê number, timestamp –æ–∫–æ–Ω—á–∞–Ω–∏—è SOS
‚îÇ   ‚îî‚îÄ‚îÄ cellId               ‚Üê string?, geo-cell ID (1‚Äì12 —Å–∏–º–≤–æ–ª–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ stateCells/{cellId}/{uid}
‚îÇ   ‚îú‚îÄ‚îÄ callsign             ‚Üê string
‚îÇ   ‚îú‚îÄ‚îÄ lat, lon, acc, speed ‚Üê numbers
‚îÇ   ‚îú‚îÄ‚îÄ ts, mode, anchored   ‚Üê number, string, boolean
‚îÇ   ‚îú‚îÄ‚îÄ sosUntilMs           ‚Üê number
‚îÇ   ‚îî‚îÄ‚îÄ cellId               ‚Üê string, –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å $cellId
‚îÇ
‚îú‚îÄ‚îÄ points/{pointId}
‚îÇ   ‚îú‚îÄ‚îÄ lat, lon             ‚Üê numbers
‚îÇ   ‚îú‚îÄ‚îÄ label                ‚Üê string, ‚â§80 —Å–∏–º–≤–æ–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ icon                 ‚Üê string, 1‚Äì32 —Å–∏–º–≤–æ–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ createdAtMs          ‚Üê number
‚îÇ   ‚îú‚îÄ‚îÄ createdBy            ‚Üê string, UID —Å–æ–∑–¥–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ updatedAtMs          ‚Üê number?
‚îÇ   ‚îú‚îÄ‚îÄ state                ‚Üê string?: 'ACTIVE', 'EXPIRED', 'DISABLED'
‚îÇ   ‚îú‚îÄ‚îÄ scope                ‚Üê string: 'TEAM'
‚îÇ   ‚îî‚îÄ‚îÄ kind                 ‚Üê string: 'POINT'
‚îÇ
‚îú‚îÄ‚îÄ privatePoints/{uid}/{pointId}
‚îÇ   ‚îú‚îÄ‚îÄ lat, lon             ‚Üê numbers
‚îÇ   ‚îú‚îÄ‚îÄ label                ‚Üê string, ‚â§80
‚îÇ   ‚îú‚îÄ‚îÄ icon                 ‚Üê string, 1‚Äì32
‚îÇ   ‚îú‚îÄ‚îÄ createdAtMs          ‚Üê number
‚îÇ   ‚îú‚îÄ‚îÄ createdBy            ‚Üê string, –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å $uid
‚îÇ   ‚îú‚îÄ‚îÄ state, scope, kind   ‚Üê –∫–∞–∫ –≤ points
‚îÇ   ‚îî‚îÄ‚îÄ scope                ‚Üê string: 'PRIVATE'
‚îÇ
‚îú‚îÄ‚îÄ enemyPings/{pingId}
‚îÇ   ‚îú‚îÄ‚îÄ lat, lon             ‚Üê numbers
‚îÇ   ‚îú‚îÄ‚îÄ createdAtMs          ‚Üê number (‚â§ now + 5000)
‚îÇ   ‚îú‚îÄ‚îÄ createdBy            ‚Üê string, UID —Å–æ–∑–¥–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ expiresAtMs          ‚Üê number (‚â§ createdAtMs + 600000)
‚îÇ   ‚îú‚îÄ‚îÄ type                 ‚Üê string: 'ENEMY', 'ATTACK', 'DEFENSE', 'DANGER', 'BLUETOOTH'
‚îÇ   ‚îú‚îÄ‚îÄ state, scope, kind   ‚Üê 'ACTIVE', 'TEAM_EVENT', 'ENEMY_PING'
‚îÇ   ‚îî‚îÄ‚îÄ updatedAtMs          ‚Üê number?
‚îÇ
‚îú‚îÄ‚îÄ rateLimits/enemyPing/{uid}
‚îÇ   ‚îî‚îÄ‚îÄ lastAtMs             ‚Üê number, timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ enemy ping
‚îÇ
‚îú‚îÄ‚îÄ commands/active
‚îÇ   ‚îú‚îÄ‚îÄ id                   ‚Üê string, 1‚Äì64 —Å–∏–º–≤–æ–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ type                 ‚Üê string: 'ENEMY', 'ATTACK', 'DEFENSE', 'DANGER', 'RALLY', 'RETREAT'
‚îÇ   ‚îú‚îÄ‚îÄ createdAtMs          ‚Üê number
‚îÇ   ‚îî‚îÄ‚îÄ createdBy            ‚Üê string, UID —Å–æ–∑–¥–∞—Ç–µ–ª—è
‚îÇ
‚îî‚îÄ‚îÄ memberPrefs/{uid}
    ‚îú‚îÄ‚îÄ preset               ‚Üê string: 'ALL', 'SOS', 'NEAR', 'ACTIVE'
    ‚îú‚îÄ‚îÄ nearRadiusM          ‚Üê number, 50‚Äì500 –º–µ—Ç—Ä–æ–≤
    ‚îú‚îÄ‚îÄ showDead             ‚Üê boolean
    ‚îú‚îÄ‚îÄ showStale            ‚Üê boolean
    ‚îú‚îÄ‚îÄ focusMode            ‚Üê boolean
    ‚îî‚îÄ‚îÄ updatedAtMs          ‚Üê number
```

### 12.2 –ò–Ω–¥–µ–∫—Å—ã

```json
{
  "teams": {
    "$teamCode": {
      "state": { ".indexOn": ["ts"] },
      "stateCells": { "$cellId": { ".indexOn": ["cellId"] } },
      "points": { ".indexOn": ["createdAtMs", "createdBy"] },
      "privatePoints": { "$uid": { ".indexOn": ["createdAtMs"] } },
      "enemyPings": { ".indexOn": ["createdAtMs", "expiresAtMs"] },
      "memberRoles": { ".indexOn": ["commandRole", "sideId", "companyId", "platoonId", "teamId"] }
    }
  }
}
```

---

## 13. –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firebase

### 13.1 –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

| –ü—Ä–∞–≤–∏–ª–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `.read`: false | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–µ—Ç —á—Ç–µ–Ω–∏—è (—Ç—Ä–µ–±—É—é—Ç—Å—è —è–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è) |
| `.write`: false | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –∑–∞–ø–∏—Å–∏ (—Ç—Ä–µ–±—É—é—Ç—Å—è —è–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è) |

### 13.2 teams/{teamCode}

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã

**–£—Å–ª–æ–≤–∏–µ:**
```json
.auth != null && !data.exists() && 
newData.hasChildren(['meta', 'members']) && 
newData.child('meta').child('createdBy').val() == auth.uid && 
newData.child('members').child(auth.uid).exists()
```

#### meta

- **–ß—Ç–µ–Ω–∏–µ:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥—ã (`createdBy == auth.uid`)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `createdAtMs`, `createdBy`, `isLocked`, `expiresAtMs`, `joinSalt`, `joinHash`
  - `joinSalt`: hex, 16‚Äì128 —Å–∏–º–≤–æ–ª–æ–≤
  - `joinHash`: hex, 64 —Å–∏–º–≤–æ–ª–∞ (SHA-256)
  - `expiresAtMs > createdAtMs`
  - `joinSalt/joinHash` –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

#### members/{uid}

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ —Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`auth.uid == $uid`)
- **–ó–∞–ø—Ä–µ—Ç –≤—Ö–æ–¥–∞:** –ï—Å–ª–∏ `isLocked == true` –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –∏—Å—Ç–µ–∫–ª–∞ (`expiresAtMs < now`)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `callsign`: —Å—Ç—Ä–æ–∫–∞, 1‚Äì24 —Å–∏–º–≤–æ–ª–∞
  - `joinedAtMs`: —á–∏—Å–ª–æ (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ)

#### memberRoles/{uid}

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ (SIDE_COMMANDER, COMPANY_COMMANDER, –∏ —Ç.–¥.)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `commandRole`: `'SIDE_COMMANDER'`, `'COMPANY_COMMANDER'`, `'PLATOON_COMMANDER'`, `'TEAM_COMMANDER'`, `'TEAM_DEPUTY'`, `'FIGHTER'`
  - `combatRole`: `'NONE'`, `'ASSAULTER'`, `'SCOUT'`, `'SNIPER'`, `'MORTAR'`
  - `vehicleRole`: `'NONE'`, `'DRIVER'`, `'ASSISTANT_DRIVER'`, `'PASSENGER'`
  - `sideId`: —Å—Ç—Ä–æ–∫–∞, 1‚Äì32 —Å–∏–º–≤–æ–ª–∞
  - `companyId`, `platoonId`, `teamId`, `vehicleId`: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1‚Äì32 —Å–∏–º–≤–æ–ª–∞
  - `updatedAtMs`: —á–∏—Å–ª–æ (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ –≤ –ø—Ä–æ—à–ª–æ–º)

#### state/{uid}

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Å–æ—Å—Ç–æ—è–Ω–∏—è (`auth.uid == $uid`)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `lat`: -90..90, `lon`: -180..180
  - `mode`: `'GAME'` –∏–ª–∏ `'DEAD'`
  - `ts <= now + 60000` (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—É–¥—É—â–∏—Ö timestamp)
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `callsign`, `lat`, `lon`, `acc`, `speed`, `ts`, `mode`, `anchored`, `sosUntilMs`

#### stateCells/{cellId}/{uid}

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Å–æ—Å—Ç–æ—è–Ω–∏—è (`auth.uid == $uid`)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `cellId` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `$cellId`
  - `cellId`: geo-cell ID, 1‚Äì12 —Å–∏–º–≤–æ–ª–æ–≤ (hex + —Ü–∏—Ñ—Ä—ã)
  - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–∞–∫ –≤ `state/{uid}`

#### points/{pointId} (–∫–æ–º–∞–Ω–¥–Ω—ã–µ —Ç–æ—á–∫–∏)

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å —Ç–æ—á–∫–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `scope == 'TEAM'`, `kind == 'POINT'`
  - `state`: `'ACTIVE'`, `'EXPIRED'`, `'DISABLED'`
  - `label`: –º–∞–∫—Å. 80 —Å–∏–º–≤–æ–ª–æ–≤
  - `icon`: 1‚Äì32 —Å–∏–º–≤–æ–ª–∞
  - `createdBy/createdAtMs` –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã

#### privatePoints/{uid}/{pointId} (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ç–æ—á–∫–∏)

- **–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ points + `scope == 'PRIVATE'` + `createdBy == $uid`

#### enemyPings/{pingId}

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `expiresAtMs <= createdAtMs + 600000` (–º–∞–∫—Å. 10 –º–∏–Ω—É—Ç)
  - `type`: `'ENEMY'`, `'ATTACK'`, `'DEFENSE'`, `'DANGER'`, `'BLUETOOTH'`
  - `scope == 'TEAM_EVENT'`, `kind == 'ENEMY_PING'`
  - Rate limiting: min 1.2s interval

#### rateLimits/enemyPing/{uid}

- **–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `lastAtMs`: —á–∏—Å–ª–æ (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ –≤ –ø—Ä–æ—à–ª–æ–º)

#### commands/active

- **–ß—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- **–ó–∞–ø–∏—Å—å:** –õ—é–±–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ –∫–æ–º–∞–Ω–¥—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `type`: `'ENEMY'`, `'ATTACK'`, `'DEFENSE'`, `'DANGER'`, `'RALLY'`, `'RETREAT'`

#### memberPrefs/{uid}

- **–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å:** –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
  - `preset`: `'ALL'`, `'SOS'`, `'NEAR'`, `'ACTIVE'`
  - `nearRadiusM`: 50‚Äì500 –º–µ—Ç—Ä–æ–≤
  - `showDead`, `showStale`, `focusMode`: boolean

---

## 14. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å join-–∫–æ–¥–∞

### 14.1 –§–æ—Ä–º–∞—Ç –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

| –ê—Å–ø–µ–∫—Ç | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|--------|------------|
| **–§–æ—Ä–º–∞—Ç –∫–æ–¥–∞** | `^\d{6}$` (—Å—Ç—Ä–æ–≥–æ 6 —Ü–∏—Ñ—Ä) |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | `joinSalt` (hex 16‚Äì128), `joinHash` (hex 64) |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞** | `verifyJoinCode` –ø—Ä–∏ `joinTeam` |
| **Mismatch** | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `NOT_FOUND` (–±–µ–∑ —É—Ç–µ—á–∫–∏) |
| **Immutable** | `joinSalt`/`joinHash` –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è |
| **Legacy teams** | 14 –¥–Ω–µ–π grace period –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ |

### 14.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏

```kotlin
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
val code = "123456"

// 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º salt (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ RTDB)
val salt = "a1b2c3d4e5f6..." // hex 16‚Äì128

// 3. –í—ã—á–∏—Å–ª—è–µ–º hash: SHA-256(code + salt)
val hash = sha256(code + salt) // hex 64

// 4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å joinHash –∏–∑ RTDB
if (hash == storedHash) {
    // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
} else {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º NOT_FOUND (–±–µ–∑ —É—Ç–µ—á–∫–∏ –¥–µ—Ç–∞–ª–µ–π)
}
```

### 14.3 Security guarantees

- ‚úÖ **No enumeration attacks** ‚Äî –ø—Ä–∏ mismatch –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `NOT_FOUND`
- ‚úÖ **No timing attacks** ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- ‚úÖ **No brute force** ‚Äî rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ Firebase Rules
- ‚úÖ **No replay attacks** ‚Äî salt —É–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã

---

## 15. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è Android

### 15.1 –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (AndroidManifest.xml)

| –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | API level | –ì—Ä—É–ø–ø–∞ |
|------------|------------|-----------|--------|
| `INTERNET` | –î–æ—Å—Ç—É–ø –∫ Firebase | –í—Å–µ | Network |
| `ACCESS_FINE_LOCATION` | –¢–æ—á–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (GPS) | –í—Å–µ | Location |
| `ACCESS_COARSE_LOCATION` | –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è | –í—Å–µ | Location |
| `VIBRATE` | –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ (SOS, alerts) | –í—Å–µ | Hardware |
| `FOREGROUND_SERVICE` | –§–æ–Ω–æ–≤–∞—è —Å–ª—É–∂–±–∞ | –í—Å–µ | Service |
| `FOREGROUND_SERVICE_LOCATION` | –§–æ–Ω–æ–≤–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ | 28+ | Service |
| `POST_NOTIFICATIONS` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | 33+ | Notification |
| `BLUETOOTH` | BLE (—Å—Ç–∞—Ä—ã–µ API) | <31 | Bluetooth |
| `BLUETOOTH_ADMIN` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ BLE | <31 | Bluetooth |
| `BLUETOOTH_SCAN` | BLE —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | 31+ | Bluetooth |
| `BLUETOOTH_CONNECT` | BLE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ | 31+ | Bluetooth |

### 15.2 –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π runtime

```kotlin
// Location permissions (Android 12+)
val permissions = arrayOf(
    Manifest.permission.ACCESS_FINE_LOCATION,
    Manifest.permission.ACCESS_COARSE_LOCATION,
)

// Bluetooth permissions (Android 12+)
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
    permissions += arrayOf(
        Manifest.permission.BLUETOOTH_SCAN,
        Manifest.permission.BLUETOOTH_CONNECT,
    )
}

// Notification permissions (Android 13+)
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
    permissions += Manifest.permission.POST_NOTIFICATIONS
}
```

### 15.3 Foreground Service

**–¢–∏–ø:** `location`

```xml
<service
    android:name=".TrackingService"
    android:foregroundServiceType="location"
    android:exported="false" />
```

**Notification channel:**
- ID: `tracking_service`
- Name: "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏"
- Importance: `LOW` (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## 16. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 16.1 –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ó–∞–ø—É—Å–∫ |
|-----|------------|------------|--------|
| **Unit —Ç–µ—Å—Ç—ã** | ~40 —Ñ–∞–π–ª–æ–≤ | –õ–æ–≥–∏–∫–∞ domain/data —Å–ª–æ—ë–≤ | `./gradlew :core:test :app:testDebugUnitTest` |
| **Instrumentation** | 16 —Ñ–∞–π–ª–æ–≤ | UI –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | `./gradlew :app:connectedDebugAndroidTest` |
| **Firebase rules** | 1 —Ñ–∞–π–ª | Security rules —ç–º—É–ª—è—Ü–∏—è | `firebase emulators:exec ...` |

### 16.2 –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã

#### Unit —Ç–µ—Å—Ç—ã (core/)

```kotlin
// GeoMathTest
- testDistanceBetween()
- testBearingTo()
- testGeoCellId()

// TeamCodeValidatorTest
- testValidCode()
- testInvalidCode()

// TrackingPolicyTest
- testShouldSendState_gameMode()
- testShouldSendState_silentMode()

// P2PChunkerTest
- testFragmentation()
- testReassembly()

// ReplayProtectorTest
- testDuplicateDetection()
- testReplayProtection()
```

#### Instrumentation —Ç–µ—Å—Ç—ã (app/src/androidTest/)

```kotlin
// TeamCompassSmokeTest
- testAppRootNavigation()

// TeamCompassInteractionTest
- testJoinScreenStateTransitions()

// BackendHealthBannerTest
- testBackendDownUiIndicator()

// FirebaseRulesEmulatorTest
- testJoinWithInvalidCode()
- testJoinWithMismatchHash()
- testJoinWhenLocked()
- testJoinWhenExpired()

// FirebaseRoleRulesEmulatorTest
- testRoleAssignment()
- testRoleBasedAccess()

// AccessibilityFlowSmokeTest
- testTalkBackNavigation()

// ProcessDeathRestoreTest
- testStateRestorationAfterProcessDeath()

// PerformanceSmokeTest
- testColdStartupTime()
- testMemoryUsage()
```

### 16.3 Hermetic test-—Ä–µ–∂–∏–º

**Instrumentation args:**

| –ê—Ä–≥—É–º–µ–Ω—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ | –≠—Ñ—Ñ–µ–∫—Ç |
|----------|----------|--------|
| `teamcompass.test.hermetic` | `true\|false` | –û—Ç–∫–ª—é—á–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `teamcompass.test.disable_telemetry` | `true\|false` | –û—Ç–∫–ª—é—á–∞–µ—Ç Analytics/Crashlytics |

**–í–∞–∂–Ω–æ:** –í–ª–∏—è—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `debug/androidTest`, release-–ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è—é—Ç.

### 16.4 –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# Smoke test
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestClass=com.example.teamcompass.TeamCompassSmokeTest" \
  "-PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"

# Interaction test
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestClass=com.example.teamcompass.TeamCompassInteractionTest" \
  "-PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"

# Firebase rules test
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestClass=com.example.teamcompass.FirebaseRulesEmulatorTest" \
  "-PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"

# Multiple test classes
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestClass=com.example.teamcompass.TeamCompassSmokeTest,com.example.teamcompass.TeamCompassInteractionTest"
```

### 16.5 Firebase —ç–º—É–ª—è—Ç–æ—Ä—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `firebase.json`

```json
{
  "emulators": {
    "auth": { "port": 9099 },
    "database": { "port": 9000 },
    "singleProjectMode": true
  }
}
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∞–≤–∏–ª:**

```bash
npx -y firebase-tools@14.22.0 emulators:exec \
  --project demo-teamcompass \
  --config firebase.json \
  --only auth,database \
  "gradlew.bat :app:connectedDebugAndroidTest -PandroidTestClass=com.example.teamcompass.FirebaseRulesEmulatorTest -PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"
```

---

## 17. CI/CD

### 17.1 Workflow: `.github/workflows/ci.yml`

#### Jobs

| Job | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | Timeout |
|-----|------------|---------|
| `repo-hygiene` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (UTF-8, secrets, guards) | 10 –º–∏–Ω |
| `baseline-compile` | –ö–æ–º–ø–∏–ª—è—Ü–∏—è + Mojibake check | 35 –º–∏–Ω |
| `baseline-unit` | Unit —Ç–µ—Å—Ç—ã | 35 –º–∏–Ω |
| `lint` | Lint –ø—Ä–æ–≤–µ—Ä–∫–∞ | 25 –º–∏–Ω |
| `android-ui-tests` | Instrumentation —Ç–µ—Å—Ç—ã (7 —Ç–µ—Å—Ç–æ–≤ –≤ –º–∞—Ç—Ä–∏—Ü–µ) | 60 –º–∏–Ω |
| `firebase-rules` | –¢–µ—Å—Ç—ã –ø—Ä–∞–≤–∏–ª Firebase | 60 –º–∏–Ω |

#### –ú–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Å—Ç–æ–≤ (android-ui-tests)

| –¢–µ—Å—Ç | –ö–ª–∞—Å—Å |
|------|-------|
| **Smoke** | `TeamCompassSmokeTest` |
| **Interaction** | `TeamCompassInteractionTest` |
| **OrientationBack** | `OrientationAndBackNavigationTest` |
| **Accessibility** | `AccessibilityFlowSmokeTest` |
| **ProcessRestore** | `ProcessDeathRestoreTest` |
| **PerfSmoke** | `PerformanceSmokeTest` |
| **CombatRadarFlow** | `CombatRadarFlowTest` |

### 17.2 Retry policy

- ‚úÖ **Infra retry:** 1 –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è `connectedDebugAndroidTest` (—Ç–æ–ª—å–∫–æ infra –æ—à–∏–±–∫–∏: adb/device)
- ‚ùå **Product failures:** 0 retry –¥–ª—è assertion/logic failures
- üì¶ **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏:**
  - `app/build/reports/androidTests/connected/**`
  - `app/build/outputs/androidTest-results/connected/**`
  - `firebase-emulators.log`

### 17.3 CI environment

```yaml
env:
  GRADLE_OPTS: -Dorg.gradle.workers.max=4 -Dorg.gradle.parallel=true
```

**–≠–º—É–ª—è—Ç–æ—Ä:**
- API level: 34
- Arch: x86_64
- Target: google_apis
- Profile: Pixel 6
- Animations: disabled

### 17.4 Nightly release smoke

**Workflow:** `.github/workflows/nightly-release-smoke.yml`

- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00 UTC
- –°–æ–±–∏—Ä–∞–µ—Ç release APK
- –ó–∞–ø—É—Å–∫–∞–µ—Ç `PerformanceSmokeTest`
- –í—ã–≥—Ä—É–∂–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

---

## 18. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞

### 18.1 –ê—É–¥–∏—Ç –æ—Ç 24 —Ñ–µ–≤—Ä–∞–ª—è 2026 (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ 25 —Ñ–µ–≤—Ä–∞–ª—è)

#### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (MAJOR)

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|----------|------|--------|--------------|
| 1 | **PendingIntent —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Android 12‚Äì14** | `EventNotificationManager.kt` | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –î–æ–±–∞–≤–ª–µ–Ω `FLAG_IMMUTABLE` (—Å—Ç—Ä–æ–∫–∞ 280) |
| 2 | **Bluetooth coordinator cleanup** | `BluetoothScanCoordinator.kt` | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –Ø–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞ scope —á–µ—Ä–µ–∑ `viewModelScope` |
| 3 | **CancellationException –æ–±—Ä–∞–±–æ—Ç–∫–∞** | `*.Coordinator.kt` | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ –≤—Å–µ—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞—Ö |

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏ (MINOR)

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|----------|------|--------|--------------|
| 4 | **SecurityException handling (notifications)** | `EventNotificationManager.kt` | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 283-286) |
| 5 | **R8/Proguard release crash risk** | `proguard-rules.pro` | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | –ù—É–∂–Ω—ã —Ç–µ—Å—Ç—ã release —Å–±–æ—Ä–∫–∏ |
| 6 | **Process death recovery** | `TeamCompassSavedStateBinder.kt` | ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û** | SavedStateHandle –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |
| 7 | **God class (TeamCompassViewModel 1920 —Å—Ç—Ä–æ–∫)** | `ui/` | ‚úÖ **–î–ï–ö–û–ú–ü–û–ó–ò–†–û–í–ê–ù–û** | –†–∞–∑–±–∏—Ç–æ –Ω–∞ 18 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤ |

### 18.2 –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è ViewModel (25 —Ñ–µ–≤—Ä–∞–ª—è 2026)

**–ë—ã–ª–æ:** `TeamCompassViewModel.kt` ‚Äî 1920 —Å—Ç—Ä–æ–∫ (God class)

**–°—Ç–∞–ª–æ:** 18 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤ + `TeamCompassViewModel` –∫–∞–∫ facade

| –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –°—Ç—Ä–æ–∫ |
|-------------|-----------------|-------|
| **SessionCoordinator** | Auth, create/join team, leave team | ~150 |
| **TrackingCoordinator** | Tracking policies, location monitor | ~200 |
| **MapCoordinator** | KMZ/KML import, marker CRUD | ~250 |
| **AlertsCoordinator** | SOS, enemy pings, notifications | ~180 |
| **TargetFilterCoordinator** | Filter presets, radius, focus mode | ~120 |
| **LocationReadinessCoordinator** | Permission checks, service readiness | ~100 |
| **BackendAvailabilityCoordinator** | Backend health monitoring | ~130 |
| **BluetoothScanCoordinator** | BLE device discovery | ~140 |
| **MapActionsCoordinator** | Map interactions | ~160 |
| **TacticalActionsCoordinator** | Tactical actions (enemy pings, commands) | ~170 |
| **HeadingSensorCoordinator** | Rotation sensor, heading | ~130 |
| **IdentityLinkingCoordinator** | Firebase identity linking | ~90 |
| **P2PInboundCoordinator** | P2P inbound messages | ~110 |
| **MemberPrefsSyncCoordinator** | Member preferences sync | ~80 |
| **TeamSnapshotSyncCoordinator** | Team snapshot sync | ~100 |
| **TeamCompassSessionListeningCoordinator** | Session listening | ~120 |
| **TeamCompassAlertEffectsCoordinator** | Alert effects (sound, vibration) | ~140 |
| **TeamCompassDeviceUiCoordinator** | Device UI coordination | ~100 |

**–ò—Ç–æ–≥–æ:** ~2420 —Å—Ç—Ä–æ–∫ (—Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ 18 —Ñ–∞–π–ª–æ–≤)  
**–í—ã–∏–≥—Ä—ã—à:** 
- ‚úÖ –ö–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –Ø–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏

### 18.3 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º

```bash
# 1. –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç—ã
./gradlew :app:assembleDebug :app:testDebugUnitTest :core:test

# 2. Instrumentation —Ç–µ—Å—Ç—ã
./gradlew :app:connectedDebugAndroidTest

# 3. Lint
./gradlew :app:lintDebug

# 4. Release build (R8 test)
./gradlew :app:assembleRelease

# 5. Runtime —Ç–µ—Å—Ç—ã
# - Android 12/13/14 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
# - Process death recovery
# - LeakCanary (memory leaks)
# - Network loss/recovery
```

### 18.3 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ)

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ (25 —Ñ–µ–≤—Ä–∞–ª—è 2026):**

- ‚úÖ **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è TeamCompassViewModel** ‚Äî —Ä–∞–∑–±–∏—Ç–æ –Ω–∞ 18 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤
- ‚úÖ **Structured concurrency** ‚Äî –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `viewModelScope`
- ‚úÖ **Error handling layer** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞—Ö
- ‚úÖ **PendingIntent —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `FLAG_IMMUTABLE`
- ‚úÖ **SecurityException handling** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ EventNotificationManager

**–¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

- ‚ö†Ô∏è **R8/Proguard release crash risk** ‚Äî –Ω—É–∂–Ω—ã —Ç–µ—Å—Ç—ã release —Å–±–æ—Ä–∫–∏
  ```bash
  ./gradlew :app:assembleRelease
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –∏ –∫—Ä–∞—à–∏
  ```

**–ü–ª–∞–Ω—ã:**

- üîú **Flow stateIn** ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å UI state –≤ `StateFlow` —á–µ—Ä–µ–∑ `stateIn`
- üîú **Device farm matrix** ‚Äî –ø–æ–ª–Ω–æ–µ e2e –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

## 19. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 19.1 –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | Roadmap |
|-------------|--------|---------|
| **Radar-first UX** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | üîú Map-first tactical client (v0.3.0) |
| **–û—Ñ–ª–∞–π–Ω P2P –∫–∞–Ω–∞–ª** | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | üîú BLE/LoRa mesh (epic, v0.4.0) |
| **iOS-–∫–ª–∏–µ–Ω—Ç** | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | üîú Future consideration (KMP?) |
| **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è RBAC** | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è | üîú Advanced role permissions (v0.3.0) |
| **WebSocket/HTTP fallback** | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | üîú Backend redundancy (ADR, v0.3.0) |
| **Device farm matrix** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üîú Full e2e coverage (CI) |

### 19.2 Reliability Notes

#### Firebase outage handling

- ‚úÖ Health monitoring —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ Reconnect UX —Å exponential backoff (max 20s)
- ‚ö†Ô∏è Firebase RTDB –æ—Å—Ç–∞—ë—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π production backend
- üîú WebSocket/HTTP fallback –≤ roadmap

#### Process death recovery

- ‚úÖ SavedStateHandle –¥–ª—è ViewModel
- ‚úÖ `rememberSaveable` –¥–ª—è UI
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç runtime-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ Android 12/13/14

#### Android 12‚Äì14 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ `FLAG_IMMUTABLE` –¥–ª—è PendingIntent
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

### 19.3 Performance metrics

**TeamCompassPerfMetrics –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:**

- ‚úÖ RTDB snapshot emits count
- ‚úÖ Cleanup sweeps count
- ‚úÖ Map bitmap cache hits / decode requests
- ‚úÖ Fullscreen map first render time
- ‚úÖ Peak app used memory

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```kotlin
vm.logPerfMetricsSnapshot()
// perf snapshot: rtdbEmits=42, cleanupSweeps=3, mapLoads=12,
// mapHits=89, mapDecodes=5, mapAvgDecodeMs=23.4,
// firstRenderSamples=8, firstRenderAvgMs=145.2
```

---

## 20. Changelog

### [0.2.1] ‚Äî 25 —Ñ–µ–≤—Ä–∞–ª—è 2026 (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

**–í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**

- **üî• –†–ï–§–ê–ö–¢–û–†–ò–ù–ì: –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è TeamCompassViewModel**
  - –†–∞–∑–±–∏—Ç–æ –Ω–∞ 18 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤ (–±—ã–ª–æ: 1920 —Å—Ç—Ä–æ–∫, —Å—Ç–∞–ª–æ: ~2420 —Å—Ç—Ä–æ–∫ / 18 —Ñ–∞–π–ª–æ–≤)
  - –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  - –Ø–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏:**

- ‚úÖ PendingIntent —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Android 12‚Äì14 (`FLAG_IMMUTABLE` –¥–æ–±–∞–≤–ª–µ–Ω)
- ‚úÖ Bluetooth coordinator cleanup
- ‚úÖ CancellationException –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ SecurityException handling (notifications)
- ‚úÖ Process death recovery (SavedStateHandle)
- ‚úÖ God class (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ 18 –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- **Backend health monitoring**
  - Periodic probe Firebase RTDB (10s interval)
  - UI banner –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ backend
  - Stale data detection (>30s –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)
  - Exponential backoff reconnect (max 20s cap)

- **SavedStateHandle –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ teamCode, defaultMode, playerMode, isTracking, mySosUntilMs
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è UI state ‚Üí SavedStateHandle

- **TeamCodeValidator**
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `core/TeamCodeValidator.kt`
  - Reuse across UI –∏ data layers

- **Performance metrics**
  - `TeamCompassPerfMetrics` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `vm.logPerfMetricsSnapshot()`

- **–¢–µ—Å—Ç—ã**
  - `BackendHealthBannerTest` ‚Äî UI indicator verification
  - `FirebaseTeamRepositoryBackendHealthPolicyTest` ‚Äî health probe logic
  - `FirebaseTeamRepositoryStateCellCacheTest` ‚Äî state cells cache
  - `FirebaseTeamRepositoryStateCellsFallbackTest` ÔøΩÔøΩÔøΩ fallback to legacy
  - `FirebaseTeamRepositoryCleanupPolicyTest` ‚Äî enemy cleanup policy

**–ò–∑–º–µ–Ω–µ–Ω–æ:**

- **FirebaseTeamRepository**
  - –î–æ–±–∞–≤–ª–µ–Ω state cells cache (5,000 entries max, prune to 4,000)
  - Fallback to legacy state listener –ø—Ä–∏ permission denied
  - Preflight timeout –¥–ª—è state cells (1.25s)

- **EventNotificationManager**
  - –£–ª—É—á—à–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤ (critical, important, info)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã vibration patterns –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

- **HeadingSensorCoordinator**
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ rotation sensor
  - Display rotation compensation (0¬∞, 90¬∞, 180¬∞, 270¬∞)
  - Low-pass filter (alpha 0.18) –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è heading

- **ScreenAutoBrightness**
  - Vertical position detection (accelerometer)
  - 2s delay –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
  - Auto-restore brightness –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

- **FirebaseTeamRepository**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Ç–µ—á–∫–∞ ValueEventListener –ø—Ä–∏ cleanup
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `DatabaseError` –≤ callbackFlow

- **TeamCompassViewModel**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ team observer subscription
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞ coroutine –ø—Ä–∏ `onCleared()`

- **TrackingRuntime**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω watchdog restart loop (max 3 restarts, –∑–∞—Ç–µ–º pause 15s)
  - SecurityException handling –¥–ª—è location updates

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

- **Firebase Security Rules**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `joinSalt` (hex 16‚Äì128)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `joinHash` (hex 64)
  - Rate limiting –¥–ª—è enemy pings (min 1.2s interval)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏:**

- –í—ã—è–≤–ª–µ–Ω–æ –≤ –∞—É–¥–∏—Ç–µ 24.02.2026:
  - PendingIntent —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Android 12‚Äì14 (Major)
  - Bluetooth coordinator cleanup (Major)
  - CancellationException –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Major)
  - SecurityException handling (Minor)
  - R8/Proguard release crash risk (Minor)

### [0.2.0] ‚Äî 21 —Ñ–µ–≤—Ä–∞–ª—è 2026

**MVP —Ä–µ–ª–∏–∑:**

- MVVM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Coordinator decomposition
- Firebase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Auth + RTDB)
- UI —ç–∫—Ä–∞–Ω—ã (Splash, Join, Compass, Settings, Map)
- –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (points, enemy pings, SOS)
- BLE —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- P2P transports (BLE, LoRa bridge)
- CI/CD pipeline
- 56 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### [0.1.0] ‚Äî –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

- –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ MVVM
- Firebase Realtime Database integration
- –ü—Ä–æ—Å—Ç–æ–π radar UI
- Location tracking

---

## 21. Roadmap

### v0.3.0 (Q2 2026)

- [ ] WebSocket/HTTP fallback –¥–ª—è backend redundancy
- [ ] Offline P2P mesh (BLE + LoRa)
- [ ] Map-first tactical client
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è RBAC –º–æ–¥–µ–ª—å
- [ ] –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (track playback)

### v0.4.0 (Q3 2026)

- [ ] iOS –∫–ª–∏–µ–Ω—Ç (Kotlin Multiplatform?)
- [ ] Voice commands integration
- [ ] Advanced analytics dashboard
- [ ] Device farm testing matrix

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏

- [ ] Web-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (API –ø–æ–ª–∏–≥–æ–Ω–æ–≤)
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (multi-team)

---

## 22. Troubleshooting

### 22.1 –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞: Gradle –µ—Å—Ç –≤—Å—é RAM

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å low-load –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
./gradlew :app:compileDebugKotlin --max-workers=1

# –û—á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å –ø–µ—Ä–µ–¥ –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π
./clean_ram_before_build.bat

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–º–æ–Ω—ã
./gradlew --stop
```

#### –ü—Ä–æ–±–ª–µ–º–∞: WiFi –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫–ª—é—á–∏—Ç—å —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ WiFi –∞–¥–∞–ø—Ç–µ—Ä–∞ (—á–µ—Ä–µ–∑ `windows_tweak.reg`)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `kill_background_processes.bat` –ø–µ—Ä–µ–¥ –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `build_limited.bat` –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

#### –ü—Ä–æ–±–ª–µ–º–∞: Firebase Rules –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
firebase use

# –î–µ–ø–ª–æ–π –ø—Ä–∞–≤–∏–ª
firebase deploy --only database

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ Firebase Console
```

#### –ü—Ä–æ–±–ª–µ–º–∞: Instrumentation —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å hermetic mode
./gradlew :app:connectedDebugAndroidTest \
  "-PandroidTestArgs=teamcompass.test.hermetic=true,teamcompass.test.disable_telemetry=true"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–º—É–ª—è—Ç–æ—Ä
adb emu kill

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Ç–µ—Å—Ç–æ–≤
./gradlew :app:cleanTest :app:cleanAndroidTest
```

### 22.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –ª–æ–≥cat
adb logcat -d > bugreport.txt

# –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É TeamCompass
adb logcat -s TeamCompass

# –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é ERROR
adb logcat *:E

# Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
adb logcat -v time | Select-String "TeamCompass|ERROR"
```

### 22.3 –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb shell pm clear com.example.teamcompass

# Uninstall + reinstall
./gradlew :app:uninstallAll :app:installDebug

# –û—á–∏—Å—Ç–∏—Ç—å Gradle –∫—ç—à
rm -rf .gradle/
./gradlew --stop
```

---

## 23. –ì–ª–æ—Å—Å–∞—Ä–∏–π

| –¢–µ—Ä–º–∏–Ω | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ |
|--------|-------------|
| **Team code** | 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∫–æ–º–∞–Ω–¥—É |
| **joinSalt/joinHash** | Security fields –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ join |
| **State cell** | Geo-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ reads |
| **Stale data** | –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 30 —Å–µ–∫—É–Ω–¥ |
| **Backend health** | –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Firebase RTDB |
| **Tracking mode** | GAME (2s interval) –∏–ª–∏ SILENT (12s, 15m) |
| **Enemy ping** | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —É–≥—Ä–æ–∑—ã (TTL 600s) |
| **SOS** | –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–æ–º |
| **P2P transport** | BLE –∏–ª–∏ LoRa bridge –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Å–≤—è–∑–∏ |
| **RTDB** | Firebase Realtime Database |
| **UID** | Firebase User ID (Anonymous Auth) |
| **Geo-cell** | –ì–µ–æ-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ (Geohash) |
| **BLE** | Bluetooth Low Energy |
| **KMZ/KML** | –§–æ—Ä–º–∞—Ç—ã –∫–∞—Ä—Ç (Google Earth) |
| **Compose** | Jetpack Compose (declarative UI) |
| **Hilt** | Dependency Injection –¥–ª—è Android |
| **StateFlow** | Kotlin Flow –¥–ª—è state management |
| **Coroutine** | Kotlin coroutine –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ |
| **Proguard/R8** | Obfuscation –¥–ª—è release —Å–±–æ—Ä–æ–∫ |
| **Instrumentation test** | Android UI —Ç–µ—Å—Ç –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ |

---

## 24. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 24.1 –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

**Firebase Project:** `sk-grom`  
**Project Number:** `290208390931`  
**Account:** stiflerr.1488@gmail.com

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤–ª–∞–¥–µ–ª—å—Ü—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

### 24.2 –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Firebase Console](https://console.firebase.google.com/project/sk-grom)
- [Firebase RTDB](https://console.firebase.google.com/project/sk-grom/database)
- [Firebase Authentication](https://console.firebase.google.com/project/sk-grom/authentication)

### 24.3 –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [`README.md`](README.md) ‚Äî –ö—Ä–∞—Ç–∫–∏–π README
- [`firebase-database.rules.json`](firebase-database.rules.json) ‚Äî Security rules
- [`firebase.json`](firebase.json) ‚Äî Firebase emulators config
- [`.github/workflows/ci.yml`](.github/workflows/ci.yml) ‚Äî CI/CD pipeline

### 24.4 –°–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| `clean_ram_before_build.bat` | –û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π |
| `build_limited.bat` | –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º |
| `monitor_ram.bat` | –ú–æ–Ω–∏—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –û–ó–£ |
| `monitor_temp.bat` | –ú–æ–Ω–∏—Ç–æ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CPU |
| `monitor_vscode.bat` | –ú–æ–Ω–∏—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ VS Code |
| `clean_gradle_cache.bat` | –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Gradle |
| `kill_background_processes.bat` | –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π |
| `apply_all_optimizations.bat` | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π |
| `set_pagefile.bat` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ–¥–∫–∞—á–∫–∏ |

### 24.5 CI —Å–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| `tools/ci/check_android_guards.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ Android guardrails |
| `tools/ci/check_deprecated_apis.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ deprecated API |
| `tools/ci/check_pending_intent_flags.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ PendingIntent flags |
| `tools/ci/check_proguard_rules.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ Proguard –ø—Ä–∞–≤–∏–ª |
| `tools/ci/check_release_hardening.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ release hardening |
| `tools/ci/check_repo_hygiene.sh` | –ü—Ä–æ–≤–µ—Ä–∫–∞ repo hygiene |
| `tools/ci/check_secrets.py` | Scan –Ω–∞ —Å–µ–∫—Ä–µ—Ç—ã |
| `tools/ci/run_guard_checks.ps1` | –ó–∞–ø—É—Å–∫ guard checks |

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 25 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 3.0 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞—É–¥–∏—Ç–∞  
**–û–±—ä—ë–º:** ~1800 —Å—Ç—Ä–æ–∫

---

*–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ TeamCompass. –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ —Å–º. [`README.md`](README.md).*
